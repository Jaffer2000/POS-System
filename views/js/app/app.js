(function(){"use strict";var e={1619:function(e,t,o){var n=o(5130),a=o(1387),s=(o(4114),o(6768)),r=o(4232);const i={class:"order-overview-container"},l={class:"search-bar-order-overview mb-3"},c={class:"input-group"},u={key:0},d={key:1},h={class:"table table-striped"},p=["onClick"],k={class:"pagination justify-content-center"},m=["onClick"];function y(e,t,o,a,y,f){return(0,s.uX)(),(0,s.CE)("div",i,[t[9]||(t[9]=(0,s.Lk)("h2",null,"Bestellingen",-1)),(0,s.Lk)("div",l,[(0,s.Lk)("div",c,[(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>y.searchQuery=e),placeholder:"Zoek op ID, Referentie, Klant of Datum",onFocus:t[1]||(t[1]=t=>e.$emit("focus-state-change",!0)),onBlur:t[2]||(t[2]=t=>e.$emit("focus-state-change",!1)),onInput:t[3]||(t[3]=(...e)=>f.onSearchInput&&f.onSearchInput(...e))},null,544),[[n.Jo,y.searchQuery]]),t[6]||(t[6]=(0,s.Lk)("span",{class:"input-group-text"},[(0,s.Lk)("i",{class:"fas fa-search"})],-1))])]),0===f.filteredOrders.length?((0,s.uX)(),(0,s.CE)("div",u,t[7]||(t[7]=[(0,s.Lk)("p",null,"Geen bestellingen gevonden.",-1)]))):((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("table",h,[t[8]||(t[8]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"#"),(0,s.Lk)("th",null,"Referentie"),(0,s.Lk)("th",null,"Klant"),(0,s.Lk)("th",null,"Betaling"),(0,s.Lk)("th",null,"Datum"),(0,s.Lk)("th",null,"Totaal")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(f.paginatedOrders.filter((e=>e)),(t=>((0,s.uX)(),(0,s.CE)("tr",{key:t.id,onClick:o=>e.$router.push({name:"OrderDetails",params:{id:t.id}}),style:{cursor:"pointer"}},[(0,s.Lk)("td",null,(0,r.v_)(t.id),1),(0,s.Lk)("td",null,(0,r.v_)(t.reference),1),(0,s.Lk)("td",null,(0,r.v_)(t.customer),1),(0,s.Lk)("td",null,(0,r.v_)(t.payment_method),1),(0,s.Lk)("td",null,(0,r.v_)(t.date),1),(0,s.Lk)("td",null,"€"+(0,r.v_)((t.total_tax_incl||0).toFixed(2)),1)],8,p)))),128))])]),(0,s.Lk)("nav",null,[(0,s.Lk)("ul",k,[(0,s.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:1===y.currentPage}])},[(0,s.Lk)("button",{class:"page-link",onClick:t[4]||(t[4]=e=>f.goToPage(y.currentPage-1))}," Vorige ")],2),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(f.pageRange,(e=>((0,s.uX)(),(0,s.CE)("li",{key:e,class:(0,r.C4)(["page-item",{active:e===y.currentPage}])},[(0,s.Lk)("button",{class:"page-link",onClick:t=>f.goToPage(e)},(0,r.v_)(e),9,m)],2)))),128)),(0,s.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:y.currentPage===f.totalPages}])},[(0,s.Lk)("button",{class:"page-link",onClick:t[5]||(t[5]=e=>f.goToPage(y.currentPage+1))}," Volgende ")],2)])])]))])}var f=o(4373),g={name:"OrderOverview",props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},token:{type:String,required:!0}},data(){return{orders:[],searchQuery:"",currentPage:1,ordersPerPage:8,totalItems:0}},computed:{filteredOrders(){if(this.searchQuery){const e=this.searchQuery.toLowerCase();return this.orders.filter((t=>t.id.toString().includes(e)||t.reference.toLowerCase().includes(e)||t.customer.toLowerCase().includes(e)||t.date.toLowerCase().includes(e)))}return this.orders},totalPages(){return Math.ceil(this.totalItems/this.ordersPerPage)},pageRange(){let e=[];const t=10,o=Math.max(1,this.currentPage-4),n=Math.min(this.totalPages,o+t-1);for(let a=o;a<=n;a++)e.push(a);return e},paginatedOrders(){return this.filteredOrders}},mounted(){this.fetchOrders()},methods:{async fetchOrders(){try{const e=await f.A.get(`${this.apiBaseUrl}/orders`,{headers:{Authorization:`Bearer ${this.token}`},params:{searchterm:this.searchQuery,page:this.currentPage,per_page:this.ordersPerPage}});console.log("API Response:",e.data),this.orders=e.data.data.list,this.totalItems=e.data.data.pagination.total_items,console.log("Orders for Page:",this.currentPage,this.orders)}catch(e){console.error("Fout bij het ophalen van bestellingen:",e)}},onSearchInput(){this.currentPage=1,this.fetchOrders()},goToPage(e){e>0&&e<=this.totalPages&&(this.currentPage=e,this.fetchOrders())}}},v=o(1241);const L=(0,v.A)(g,[["render",y]]);var b=L;const P={class:"order-details-container"},C={key:0,class:"order-details-content"},w={class:"d-flex justify-content-between align-items-center"},I={class:"table"},E={key:0},_={class:"table"},T=["src"],O={key:1},x={key:1};function A(e,t,o,a,i,l){return(0,s.uX)(),(0,s.CE)("div",P,[i.order?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",w,[(0,s.Lk)("h2",null,"Bestelgegevens - ID: "+(0,r.v_)(i.order.id),1),(0,s.Lk)("button",{class:"print-order-btn btn",onClick:t[0]||(t[0]=(...e)=>l.handlePrint&&l.handlePrint(...e))},t[7]||(t[7]=[(0,s.Lk)("i",{class:"fas fa-print me-2"},null,-1),(0,s.eW)(" Print Bestelling ")]))]),(0,s.Lk)("table",I,[t[8]||(t[8]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Referentie"),(0,s.Lk)("th",null,"Klant"),(0,s.Lk)("th",null,"Datum"),(0,s.Lk)("th",null,"Totaal")])],-1)),(0,s.Lk)("tbody",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("td",null,(0,r.v_)(i.order.reference),1),(0,s.Lk)("td",null,(0,r.v_)(i.order.customer||"Geen klantinformatie"),1),(0,s.Lk)("td",null,(0,r.v_)(i.order.date),1),(0,s.Lk)("td",null,"€"+(0,r.v_)(i.order.total_tax_incl.toFixed(2)),1)])])]),t[12]||(t[12]=(0,s.Lk)("h3",null,"Gekochte artikelen",-1)),i.order.lines&&i.order.lines.length>0?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.Lk)("table",_,[t[9]||(t[9]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Afbeelding"),(0,s.Lk)("th",null,"Naam"),(0,s.Lk)("th",null,"Referentie"),(0,s.Lk)("th",null,"Aantal"),(0,s.Lk)("th",null,"Prijs")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.order.lines,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.product_id},[(0,s.Lk)("td",null,[(0,s.Lk)("img",{src:e.image_url,alt:"Product afbeelding",style:{"max-width":"50px"}},null,8,T)]),(0,s.Lk)("td",null,(0,r.v_)(e.name),1),(0,s.Lk)("td",null,(0,r.v_)(e.reference),1),(0,s.Lk)("td",null,(0,r.v_)(e.quantity),1),(0,s.Lk)("td",null,"€"+(0,r.v_)(e.price_tax_incl.toFixed(2)),1)])))),128))])])])):((0,s.uX)(),(0,s.CE)("div",O,t[10]||(t[10]=[(0,s.Lk)("p",null,"Geen artikelen gevonden in deze bestelling.",-1)]))),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.goToOrderOverview&&l.goToOrderOverview(...e)),class:"back-to-orders-btn btn mt-3"},t[11]||(t[11]=[(0,s.Lk)("i",{class:"fas fa-arrow-left me-1"},null,-1),(0,s.eW)(" Terug naar Bestellingen ")]))])):((0,s.uX)(),(0,s.CE)("div",x,t[13]||(t[13]=[(0,s.Lk)("p",null,"Bezig met het laden van Bestelgegevens...",-1)]))),i.showPopup?((0,s.uX)(),(0,s.CE)("div",{key:2,class:"popup-overlay",onClick:t[6]||(t[6]=(...e)=>l.closePopup&&l.closePopup(...e))},[(0,s.Lk)("div",{class:"popup-message",onClick:t[5]||(t[5]=(0,n.D$)((()=>{}),["stop"]))},[t[14]||(t[14]=(0,s.Lk)("h3",null,"Kies het type document:",-1)),(0,s.Lk)("button",{onClick:t[2]||(t[2]=e=>l.printDocument("INVOICE"))},"Factuur"),(0,s.Lk)("button",{onClick:t[3]||(t[3]=e=>l.printDocument("RECEIPT"))},"Bon"),(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.closePopup&&l.closePopup(...e))},"Annuleren")])])):(0,s.Q3)("",!0)])}var $={name:"OrderDetails",props:{id:{type:String,required:!0},apiBaseUrl:{type:String,required:!0},token:{type:String,required:!0}},data(){return{order:null,showPopup:!1}},mounted(){this.fetchOrderDetails()},methods:{async fetchOrderDetails(){try{const e=await f.A.get(`${this.apiBaseUrl}/orders/${this.id}`,{headers:{Authorization:`Bearer ${this.token}`}});this.order=e.data.data||null}catch(e){console.error("Fout bij het ophalen van orderdetails:",e),this.order=null}},handlePrint(){this.showPopup=!0},closePopup(){this.showPopup=!1},async printDocument(e){if(this.order&&this.order.id)try{const t=await f.A.post(`${this.apiBaseUrl}/orders/print-document`,{order_id:this.order.id,print_type:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});console.log("Printen succesvol:",t.data),alert("Document succesvol geprint!"),this.closePopup()}catch(t){console.error("Fout bij het printen:",t.response?.data||t),alert("Er is een fout opgetreden bij het printen van het document."),this.closePopup()}else console.error("Fout: Geen order ID beschikbaar.")},goToOrderOverview(){this.$router.push({name:"Bestellingen"})}}};const S=(0,v.A)($,[["render",A]]);var q=S;const B=[{path:"/index.html",name:"Home",props:!0},{path:"/bestellingen",name:"Bestellingen",component:b},{path:"/bestellingen/:id",name:"OrderDetails",component:q,props:!0}],F=(0,a.aE)({history:(0,a.Bt)(),routes:B});var D=F;const U={key:1},M={class:"container-fluid main-content"},Q={class:"row"},R={class:"col-2"},X={class:"col-5",style:{padding:"20px"}},j={class:"col-5"};function N(e,t,o,n,a,r){const i=(0,s.g2)("LoginComponent"),l=(0,s.g2)("HeaderComponent"),c=(0,s.g2)("SidebarComponent"),u=(0,s.g2)("router-view"),d=(0,s.g2)("CashRegister"),h=(0,s.g2)("ErrorPopup");return(0,s.uX)(),(0,s.CE)("div",null,[a.token?((0,s.uX)(),(0,s.CE)("div",U,[(0,s.bF)(l,{"api-base-url":o.apiBaseUrl,translations:o.translations,"disable-focus":a.disableFocus,token:a.token,user:a.user,onProductScanned:r.addProductToOrder,onLogout:r.logout},null,8,["api-base-url","translations","disable-focus","token","user","onProductScanned","onLogout"]),(0,s.Lk)("div",M,[(0,s.Lk)("div",Q,[(0,s.Lk)("div",R,[(0,s.bF)(c)]),(0,s.Lk)("div",X,[(0,s.bF)(u,{"api-base-url":o.apiBaseUrl,orderItems:a.orderItems,translations:o.translations,token:a.token,onFocusStateChange:r.updateFocusState},null,8,["api-base-url","orderItems","translations","token","onFocusStateChange"])]),(0,s.Lk)("div",j,[(0,s.bF)(d,{"api-base-url":o.apiBaseUrl,orderItems:a.orderItems,translations:o.translations,token:a.token,onRemoveItem:r.removeProductFromOrder,onUpdateQuantity:r.updateItemQuantity,onSetQuantity:r.setItemQuantity,onClearOrderItems:r.clearOrderItems,onModalStateChange:r.updateModalState},null,8,["api-base-url","orderItems","translations","token","onRemoveItem","onUpdateQuantity","onSetQuantity","onClearOrderItems","onModalStateChange"])])])]),(0,s.bF)(h,{ref:"errorPopup"},null,512)])):((0,s.uX)(),(0,s.Wv)(i,{key:0,"api-base-url":o.apiBaseUrl,translations:o.translations,onLoginSuccess:r.setToken},null,8,["api-base-url","translations","onLoginSuccess"]))])}const K={class:"login-container"},W={class:"form-group"},z={class:"form-group"},V={class:"form-group"},J=["value"],H={key:0,class:"error-message"};function G(e,t,o,a,i,l){return(0,s.uX)(),(0,s.CE)("div",K,[t[8]||(t[8]=(0,s.Lk)("h2",{class:"login-title"},"Login",-1)),(0,s.Lk)("form",{onSubmit:t[3]||(t[3]=(0,n.D$)(((...e)=>l.handleLogin&&l.handleLogin(...e)),["prevent"])),class:"login-form"},[(0,s.Lk)("div",W,[t[4]||(t[4]=(0,s.Lk)("label",{for:"username",class:"form-label"},"Gebruikersnaam",-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),type:"text",placeholder:"Gebruikersnaam",class:"form-input",required:""},null,512),[[n.Jo,i.username]])]),(0,s.Lk)("div",z,[t[5]||(t[5]=(0,s.Lk)("label",{for:"password",class:"form-label"},"Wachtwoord",-1)),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),type:"password",placeholder:"Wachtwoord",class:"form-input",required:""},null,512),[[n.Jo,i.password]])]),(0,s.Lk)("div",V,[t[6]||(t[6]=(0,s.Lk)("label",{for:"workstation",class:"form-label"},"Kassa",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.workstationId=e),id:"workstation",class:"form-select",required:""},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.workstations,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,r.v_)(e.name),9,J)))),128))],512),[[n.u1,i.workstationId]])]),t[7]||(t[7]=(0,s.Lk)("button",{type:"submit",class:"login-button"},"Inloggen",-1))],32),i.errorMessage?((0,s.uX)(),(0,s.CE)("p",H,(0,r.v_)(i.errorMessage),1)):(0,s.Q3)("",!0)])}var Z={data(){return{username:"",password:"",role:"cashier",workstationId:null,workstations:[],errorMessage:""}},async created(){try{const e=await f.A.get(`${this.$props.apiBaseUrl}/workstations`);this.workstations=e.data.data;const t=localStorage.getItem("lastWorkstationId");t&&this.workstations.some((e=>e.id===t))&&(this.workstationId=t)}catch(e){this.errorMessage="Failed to load workstations."}},methods:{async handleLogin(){try{if(!this.workstationId)return void(this.errorMessage="Please select a workstation.");const e=await f.A.post(`${this.$props.apiBaseUrl}/users`,{username:this.username,password:this.password,role:this.role,workstationId:this.workstationId}),{token:t,expiresIn:o}=e.data.data;console.log("Token received from login:",t),localStorage.setItem("lastWorkstationId",this.workstationId);const n=Date.now()+1e3*o;localStorage.setItem("tokenExpirationTime",n),this.$emit("login-success",t.value)}catch(e){this.errorMessage=this.translations.loginFailed,console.error("Login error:",e)}}},props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0}}};const Y=(0,v.A)(Z,[["render",G]]);var ee=Y;function te(e,t,o,n,a,r){const i=(0,s.g2)("OrderSummary");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(i,{"api-base-url":o.apiBaseUrl,orderItems:o.orderItems,translations:o.translations,token:o.token,onRemoveItem:r.removeProductFromOrder,onUpdateQuantity:r.updateItemQuantity,onSetQuantity:r.setItemQuantity,onClearOrderItems:r.forwardClearOrderItems,onModalStateChange:r.forwardModalStateChange},null,8,["api-base-url","orderItems","translations","token","onRemoveItem","onUpdateQuantity","onSetQuantity","onClearOrderItems","onModalStateChange"])])}const oe={class:"order-summary"},ne={ref:"orderList",class:"order-items-list"},ae=["onClick"],se=["src","alt"],re={class:"item-details"},ie={class:"item-header"},le={class:"product-name"},ce={class:"product-price"},ue={class:"product-price1"},de={class:"quantity-controls"},he=["onClick"],pe={class:"quantity-wrapper"},ke={key:2,class:"quantity-counter"},me=["onClick"],ye=["onClick"],fe={class:"bottom-section"},ge={class:"keyboard"},ve={class:"keyboard-row"},Le={class:"keyboard-row"},be={class:"keyboard-row"},Pe={class:"keyboard-row"},Ce={class:"summary-of-costs"},we={class:"cost-item"},Ie={class:"price"},Ee={class:"cost-item"},_e={key:0,class:"price"},Te={class:"cost-item"},Oe={class:"price"},xe={class:"cost-item-total"},Ae={class:"total-price"},$e={key:0,class:"popup-overlay"},Se={class:"popup-message"},qe={class:"modal-content"},Be={class:"order-items-scrollable"},Fe={class:"item-info"},De={class:"product-name1"},Ue={class:"product-quantity"},Me={class:"product-pricee"},Qe={class:"total-price1"},Re={class:"payment-methods"},Xe={key:0,class:"cash-fields"},je=["value"],Ne={key:1,class:"payment-warning"},Ke={key:2,class:"confirmation-popup-overlay"},We={class:"confirmation-popup"},ze={key:3,class:"confirmation-popup-overlay"},Ve={class:"confirmation-popup"},Je={id:"receipt-content",style:{display:"none"}},He={class:"item-info"},Ge={class:"product-name1"},Ze={class:"product-quantity"},Ye={class:"product-pricee"};function et(e,t,o,a,i,l){return(0,s.uX)(),(0,s.CE)("div",oe,[t[54]||(t[54]=(0,s.Lk)("div",{class:"space",style:{height:"50px"}},null,-1)),(0,s.Lk)("div",ne,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.orderItems,(o=>((0,s.uX)(),(0,s.CE)("div",{key:o.refcode,class:(0,r.C4)(["order-item",{selected:i.selectedProduct&&i.selectedProduct.refcode===o.refcode}]),onClick:e=>l.selectProduct(o)},[(0,s.Lk)("img",{src:o.image_url,alt:o.name,class:"product-image"},null,8,se),(0,s.Lk)("div",re,[(0,s.Lk)("div",ie,[(0,s.Lk)("span",le,(0,r.v_)(o.name),1),(0,s.Lk)("span",ce,[(0,s.eW)(" €"+(0,r.v_)(o.price_tax_incl?o.price_tax_incl.toFixed(2):"0.00")+" ",1),t[34]||(t[34]=(0,s.Lk)("span",{style:{"font-weight":"normal"}},"(incl. btw)",-1))]),(0,s.Lk)("span",ue,[(0,s.eW)("€"+(0,r.v_)(o.price_tax_excl.toFixed(2))+" ",1),t[35]||(t[35]=(0,s.Lk)("span",{style:{"font-weight":"normal"}},"(excl. btw)",-1))])]),(0,s.Lk)("div",de,[(0,s.Lk)("button",{onClick:t=>e.$emit("update-quantity",{refcode:o.refcode,quantity:-1}),class:"quantity-button"},t[36]||(t[36]=[(0,s.Lk)("i",{class:"fa-solid fa-minus"},null,-1)]),8,he),(0,s.Lk)("div",pe,[i.quantityEditable&&i.selectedProduct&&i.selectedProduct.refcode===o.refcode?(0,s.bo)(((0,s.uX)(),(0,s.CE)("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>i.editableQuantity=e),type:"number",class:"editable-quantity",onClick:t[1]||(t[1]=(0,n.D$)((()=>{}),["stop"]))},null,512)),[[n.Jo,i.editableQuantity]]):(0,s.Q3)("",!0),i.quantityEditable&&i.selectedProduct&&i.selectedProduct.refcode===o.refcode?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t[2]||(t[2]=(...e)=>l.confirmQuantity&&l.confirmQuantity(...e)),class:"checkmark-button"},t[37]||(t[37]=[(0,s.Lk)("i",{class:"fa-solid fa-check"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",ke,(0,r.v_)(o.quantity),1))]),(0,s.Lk)("button",{onClick:t=>e.$emit("update-quantity",{refcode:o.refcode,quantity:1}),class:"quantity-button"},t[38]||(t[38]=[(0,s.Lk)("i",{class:"fa-solid fa-plus"},null,-1)]),8,me)])]),(0,s.Lk)("button",{onClick:e=>l.removeItem(o.refcode),class:"delete-button"},t[39]||(t[39]=[(0,s.Lk)("i",{class:"fa-solid fa-trash-can"},null,-1)]),8,ye)],10,ae)))),128)),t[40]||(t[40]=(0,s.Lk)("div",{class:"scroll-spacer"},null,-1))],512),(0,s.Lk)("div",fe,[(0,s.Lk)("div",ge,[(0,s.Lk)("div",ve,[(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.setQuantityMode&&l.setQuantityMode(...e))},"Aant."),(0,s.Lk)("button",{onClick:t[4]||(t[4]=e=>l.handleKeyPress(1))},"1"),(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>l.handleKeyPress(2))},"2"),(0,s.Lk)("button",{onClick:t[6]||(t[6]=e=>l.handleKeyPress(3))},"3")]),(0,s.Lk)("div",Le,[(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>l.editFlatDiscount&&l.editFlatDiscount(...e))},"Prijs"),(0,s.Lk)("button",{onClick:t[8]||(t[8]=e=>l.handleKeyPress(4))},"4"),(0,s.Lk)("button",{onClick:t[9]||(t[9]=e=>l.handleKeyPress(5))},"5"),(0,s.Lk)("button",{onClick:t[10]||(t[10]=e=>l.handleKeyPress(6))},"6")]),(0,s.Lk)("div",be,[(0,s.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>l.editDiscount&&l.editDiscount(...e))},"%"),(0,s.Lk)("button",{onClick:t[12]||(t[12]=e=>l.handleKeyPress(7))},"7"),(0,s.Lk)("button",{onClick:t[13]||(t[13]=e=>l.handleKeyPress(8))},"8"),(0,s.Lk)("button",{onClick:t[14]||(t[14]=e=>l.handleKeyPress(9))},"9")]),(0,s.Lk)("div",Pe,[(0,s.Lk)("button",{onClick:t[15]||(t[15]=e=>l.handleKeyPress("delete"))},"Del"),t[41]||(t[41]=(0,s.Lk)("button",null,"+/-",-1)),(0,s.Lk)("button",{onClick:t[16]||(t[16]=e=>l.handleKeyPress(0))},"0"),(0,s.Lk)("button",{onClick:t[17]||(t[17]=e=>l.handleKeyPress("."))},".")]),t[42]||(t[42]=(0,s.Lk)("button",{class:"customer-button"},[(0,s.Lk)("div",{class:"user-icon"},[(0,s.Lk)("i",{class:"fas fa-user"})]),(0,s.eW)(" Klant ")],-1))]),(0,s.Lk)("div",Ce,[(0,s.Lk)("div",we,[t[43]||(t[43]=(0,s.eW)(" Subtotaal ")),(0,s.Lk)("span",Ie,"€"+(0,r.v_)(l.subtotal.toFixed(2)),1)]),(0,s.Lk)("div",Ee,[t[46]||(t[46]=(0,s.eW)(" Korting ")),i.discountEditable||i.flatDiscountEditable?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",_e," €"+(0,r.v_)(l.discount.toFixed(2)),1)),(0,s.Lk)("div",{class:(0,r.C4)(["discount-input-wrapper",{hidden:!i.discountEditable}])},[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.discountPercentage=e),type:"text",class:"discount-input",min:"0",max:"100",step:"1"},null,512),[[n.Jo,i.discountPercentage]]),(0,s.Lk)("button",{onClick:t[19]||(t[19]=e=>l.confirmDiscount("percentage")),class:"checkmark-button"},t[44]||(t[44]=[(0,s.Lk)("i",{class:"fa-solid fa-check"},null,-1)]))],2),(0,s.Lk)("div",{class:(0,r.C4)(["discount-input-wrapper",{hidden:!i.flatDiscountEditable}])},[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>i.flatDiscountAmount=e),type:"text",class:"discount-input",min:"0",step:"0.01"},null,512),[[n.Jo,i.flatDiscountAmount]]),(0,s.Lk)("button",{onClick:t[21]||(t[21]=e=>l.confirmDiscount("amount")),class:"checkmark-button"},t[45]||(t[45]=[(0,s.Lk)("i",{class:"fa-solid fa-check"},null,-1)]))],2)]),(0,s.Lk)("div",Te,[t[47]||(t[47]=(0,s.eW)(" Btw ")),(0,s.Lk)("span",Oe,"€"+(0,r.v_)(l.vat.toFixed(2)),1)]),(0,s.Lk)("div",xe,[t[48]||(t[48]=(0,s.eW)(" Totaalprijs ")),(0,s.Lk)("span",Ae,"€"+(0,r.v_)(l.totalPrice.toFixed(2)),1)]),(0,s.Lk)("button",{class:"checkout-button",onClick:t[22]||(t[22]=(...e)=>l.openModal&&l.openModal(...e))}," Doorgaan naar afrekenen ")])]),i.showPopup?((0,s.uX)(),(0,s.CE)("div",$e,[(0,s.Lk)("div",Se,[(0,s.Lk)("p",null,(0,r.v_)(this.translations.invalidDiscount),1),(0,s.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>l.closePopup&&l.closePopup(...e))},"Sluiten")])])):(0,s.Q3)("",!0),i.showModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"modal-overlay",onClick:t[29]||(t[29]=(0,n.D$)(((...e)=>l.closeModal&&l.closeModal(...e)),["self"]))},[(0,s.Lk)("div",qe,[t[52]||(t[52]=(0,s.Lk)("h2",null,"Betalen",-1)),(0,s.Lk)("div",Be,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.orderItems,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.refcode,class:"modal-order-item"},[(0,s.Lk)("div",Fe,[(0,s.Lk)("span",De,(0,r.v_)(e.name),1),(0,s.Lk)("span",Ue,"x"+(0,r.v_)(e.quantity),1),(0,s.Lk)("span",Me,"€"+(0,r.v_)(e.price_tax_incl.toFixed(2)),1)])])))),128))]),(0,s.Lk)("p",Qe,"Totaalprijs: €"+(0,r.v_)(l.totalPrice.toFixed(2)),1),(0,s.Lk)("div",Re,[t[51]||(t[51]=(0,s.Lk)("h3",null,"Selecteer Betaalmethode",-1)),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"radio","onUpdate:modelValue":t[24]||(t[24]=e=>i.selectedPaymentMethod=e),value:"cash"},null,512),[[n.XL,i.selectedPaymentMethod]]),t[49]||(t[49]=(0,s.eW)(" Contant "))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"radio","onUpdate:modelValue":t[25]||(t[25]=e=>i.selectedPaymentMethod=e),value:"card"},null,512),[[n.XL,i.selectedPaymentMethod]]),t[50]||(t[50]=(0,s.eW)(" Kaart "))]),"cash"===i.selectedPaymentMethod?((0,s.uX)(),(0,s.CE)("div",Xe,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[26]||(t[26]=e=>i.cashReceived=e),class:"received-input",placeholder:"Ontvangen bedrag"},null,512),[[n.Jo,i.cashReceived,void 0,{number:!0}]]),(0,s.Lk)("input",{type:"text",class:"change-input",value:l.calculateChange,placeholder:"Wisselgeld",readonly:""},null,8,je)])):(0,s.Q3)("",!0),i.showPaymentWarning?((0,s.uX)(),(0,s.CE)("p",Ne,(0,r.v_)(this.translations.paymentWarning),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>l.confirmCheckout&&l.confirmCheckout(...e)),class:"confirm-checkout-modal"}," Bevestig Betaling "),(0,s.Lk)("button",{onClick:t[28]||(t[28]=(...e)=>l.closeModal&&l.closeModal(...e)),class:"close-modal"},"Sluiten")])])):(0,s.Q3)("",!0),i.showPaymentConfirmation?((0,s.uX)(),(0,s.CE)("div",Ke,[(0,s.Lk)("div",We,[(0,s.Lk)("p",null,(0,r.v_)(this.translations.paymentConfirmation),1),(0,s.Lk)("button",{onClick:t[30]||(t[30]=e=>l.handlePaymentConfirmation(!0))},"Ja"),(0,s.Lk)("button",{onClick:t[31]||(t[31]=e=>l.handlePaymentConfirmation(!1))},"Nee")])])):(0,s.Q3)("",!0),i.showReceiptPopup?((0,s.uX)(),(0,s.CE)("div",ze,[(0,s.Lk)("div",Ve,[(0,s.Lk)("p",null,(0,r.v_)(this.translations.receiptConfirmation),1),(0,s.Lk)("button",{onClick:t[32]||(t[32]=e=>l.handleReceiptSelection(!0))},"Ja"),(0,s.Lk)("button",{onClick:t[33]||(t[33]=e=>l.handleReceiptSelection(!1))},"Nee")])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Je,[t[53]||(t[53]=(0,s.Lk)("h2",null,"Receipt",-1)),(0,s.Lk)("p",null,"Total: €"+(0,r.v_)(l.totalPrice.toFixed(2)),1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.orderItems,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.refcode,class:"modal-order-item"},[(0,s.Lk)("div",He,[(0,s.Lk)("span",Ge,(0,r.v_)(e.name),1),(0,s.Lk)("span",Ze,"x"+(0,r.v_)(e.quantity),1),(0,s.Lk)("span",Ye,"€"+(0,r.v_)(e.price_tax_incl.toFixed(2)),1)])])))),128))])])}var tt={data(){return{previousItemCount:0,selectedProduct:null,quantityMode:!1,quantityEditable:!1,editableQuantity:0,discountEditable:!1,flatDiscountEditable:!1,discountPercentage:0,flatDiscountAmount:0,previousDiscountPercentage:0,previousFlatDiscountAmount:0,newTotal:0,cashReceived:0,showPopup:!1,showModal:!1,selectedPaymentMethod:null,showPaymentWarning:!1,showPaymentConfirmation:!1,showReceiptPopup:!1}},props:{orderItems:{type:Array,required:!0},apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},token:{type:String,required:!0}},watch:{orderItems:{handler(e){e.length>this.previousItemCount&&this.scrollToBottom(),this.previousItemCount=e.length},deep:!0},selectedPaymentMethod(e){"cash"===e&&(this.showPaymentWarning=!1)},showModal(e){this.$emit("modal-state-change",e)}},computed:{totalPrice(){const e=this.subtotal-this.discount;return e+this.vat},subtotal(){return this.orderItems.reduce(((e,t)=>e+(parseFloat(t.price_tax_excl)||0)*t.quantity),0)},vat(){const e=this.orderItems.reduce(((e,t)=>e+(parseFloat(t.price_tax_incl)-parseFloat(t.price_tax_excl))*t.quantity),0);return e},discount(){if(this.flatDiscountAmount>0)return this.flatDiscountAmount;if(this.discountPercentage>0){const e=this.subtotal+this.vat;return this.discountPercentage/100*e}return 0},calculateChange(){return(this.cashReceived-this.totalPrice).toFixed(2)}},methods:{removeItem(e){this.$emit("remove-item",e)},selectProduct(e){this.selectedProduct=e,this.editableQuantity=e.quantity},setQuantityMode(){this.quantityEditable=!0},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.orderList;e&&(e.scrollTop=e.scrollHeight)}))},handleKeyPress(e){this.selectedProduct&&this.quantityEditable?this.handleInput("editableQuantity",e):this.discountEditable?this.handleInput("discountPercentage",e):this.flatDiscountEditable&&this.handleInput("flatDiscountAmount",e)},handleInput(e,t){const o=this[e]?.toString()||"0";isNaN(t)?"delete"===t?this[e]=o.slice(0,-1)||"0":"."===t?o.includes(".")||(this[e]=o+"."):"enter"===t&&(this[e]=parseFloat(this[e])||0):this[e]="0"===o?t.toString():o+t.toString()},confirmQuantity(){const e=parseInt(this.editableQuantity,10);if(isNaN(e)||""===this.editableQuantity)return this.editableQuantity=this.selectedProduct.quantity,void(this.quantityEditable=!1);0===e?this.$emit("remove-item",this.selectedProduct.refcode):this.$emit("set-quantity",{refcode:this.selectedProduct.refcode,setQuantity:e}),this.quantityEditable=!1},handleOutsideClick(e){this.quantityEditable&&!this.$el.contains(e.target)&&this.confirmQuantity()},editDiscount(){this.discountEditable=!0,this.flatDiscountEditable=!1},editFlatDiscount(){this.flatDiscountEditable=!0,this.discountEditable=!1},startEditingDiscount(){this.previousDiscountPercentage=this.discountPercentage,this.discountEditable=!0},confirmDiscount(e){if("percentage"===e){if(this.discountPercentage<0||this.discountPercentage>100)return void(this.showPopup=!0);this.flatDiscountAmount=0,this.discountEditable=!1}else if("amount"===e){if(this.flatDiscountAmount<0||this.flatDiscountAmount>this.subtotal+this.vat)return void(this.showPopup=!0);this.discountPercentage=0,this.flatDiscountEditable=!1}this.discountPercentage=parseFloat(this.discountPercentage)||0,this.flatDiscountAmount=parseFloat(this.flatDiscountAmount)||0;const t={discount_type:e,value:"percentage"===e?this.discountPercentage:this.flatDiscountAmount};fetch(`${this.apiBaseUrl}/orders/apply-discount`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(t)}).then((e=>{if(!e.ok)throw new Error(`Server error: ${e.status}`);return e.json()})).then((e=>{e&&e.new_total&&(this.newTotal=e.new_total)})).catch((e=>{console.error("Error applying discount:",e)}))},closePopup(){this.showPopup=!1,this.discountPercentage=this.previousDiscountPercentage||0,this.flatDiscountAmount=this.previousFlatDiscountAmount||0},openModal(){this.showModal=!0},closeModal(){this.showModal=!1,this.showPaymentWarning=!1,this.selectedPaymentMethod=null},async confirmCheckout(){this.selectedPaymentMethod?(this.showPaymentConfirmation=!0,this.showPaymentWarning=!1):this.showPaymentWarning=!0},async createNewOrder(){try{const e=await f.A.post(`${this.apiBaseUrl}/orders/new`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handleNewOrderResponse(e.data)}catch(e){console.error("Error creating new order:",e)}},async cancelOrder(){try{const e=await f.A.post(`${this.apiBaseUrl}/orders/cancel`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handleCancelOrderResponse(e.data)}catch(e){console.error("Error canceling order:",e)}},async cancelPayment(){try{const e=await f.A.post(`${this.apiBaseUrl}/payment/cancel`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handleCancelOrderResponse(e.data)}catch(e){console.error("Error canceling payment:",e)}},async handlePaymentConfirmation(e){if(e){console.log("Payment completed successfully.");const e=this.totalPrice.toFixed(2),o="cash"===this.selectedPaymentMethod?"CASH":"CREDIT_CARD_OFFLINE";try{const t=await f.A.post(`${this.apiBaseUrl}/checkout`,{amount:e,paymentMethod:o},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});let n;this.handleCheckoutResponse(t.data),"cash"===this.selectedPaymentMethod?(n=await f.A.post(`${this.apiBaseUrl}/payment/cash`,{amount:e,paymentMethod:o},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}}),this.handleCashPaymentResponse(n.data)):"card"===this.selectedPaymentMethod&&(n=await f.A.post(`${this.apiBaseUrl}/payment/card`,{amount:e,paymentMethod:o},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}}),this.handleCardPaymentResponse(n.data))}catch(t){t.response&&400===t.response.status?console.log("Checkout failed:",t.response.data):console.error("An unexpected error occurred:",t)}this.showPaymentConfirmation=!1,this.selectedPaymentMethod=null,this.showReceiptPopup=!0}else this.showPaymentConfirmation=!1},async handleReceiptSelection(e){this.showReceiptPopup=!1,e?(this.showModal=!1,this.printReceipt(),console.log("User wants a receipt.")):(this.showModal=!1,console.log("User does not want a receipt.")),await this.createNewOrder(),this.discountPercentage=0,this.flatDiscountAmount=0,setTimeout((()=>{this.$emit("clear-order-items")}),3e3)},async printReceipt(){try{const e=await f.A.get(`${this.apiBaseUrl}/orders?sort=date_desc&page=1&per_page=1`,{headers:{Authorization:`Bearer ${this.token}`}}),t=e.data.data.list;if(0===t.length)return void alert("No orders found.");const o=t[0];console.log("Order ID for printing:",o.id);const n=await f.A.post(`${this.apiBaseUrl}/orders/print-document`,{order_id:o.id,print_type:"RECEIPT"},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handlePrintReceiptResponse(n.data)}catch(e){console.error("Error printing receipt:",e)}},handleCheckoutResponse(e){"success"===e.status?this.showPaymentConfirmation=!0:"fail"===e.status&&console.error("Checkout failed:",e.data.message)}},mounted(){document.addEventListener("click",this.handleOutsideClick)},beforeUnmount(){document.removeEventListener("click",this.handleOutsideClick)}};const ot=(0,v.A)(tt,[["render",et]]);var nt=ot,at={components:{OrderSummary:nt},props:{orderItems:{type:Array,required:!0},apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},token:{type:String,required:!0}},methods:{removeProductFromOrder(e){this.$emit("remove-item",e)},updateItemQuantity(e){this.$emit("update-quantity",e)},setItemQuantity(e){this.$emit("set-quantity",e)},forwardClearOrderItems(){this.$emit("clear-order-items")},forwardModalStateChange(e){this.$emit("modal-state-change",e)}}};const st=(0,v.A)(at,[["render",te]]);var rt=st;const it={class:"header-content"},lt={class:"search-bar"},ct={class:"user-info"},ut={class:"user-signoff"},dt={key:0,class:"popup-overlay"},ht={class:"popup-message"};function pt(e,t,o,a,i,l){return(0,s.uX)(),(0,s.CE)("header",null,[(0,s.Lk)("div",it,[t[8]||(t[8]=(0,s.Lk)("span",{class:"header-title"},"Point of Sale",-1)),(0,s.Lk)("div",lt,[t[4]||(t[4]=(0,s.Lk)("i",{class:"fas fa-magnifying-glass search-icon"},null,-1)),(0,s.bo)((0,s.Lk)("input",{ref:"searchInput",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.barcodeInput=e),onInput:t[1]||(t[1]=(...e)=>i.debouncedOnBarcodeInput&&i.debouncedOnBarcodeInput(...e)),id:"barcodeInput",placeholder:"Zoek Product op Naam, Barcode, Product id"},null,544),[[n.Jo,i.barcodeInput]]),t[5]||(t[5]=(0,s.Lk)("i",{class:"fas fa-barcode barcode-icon"},null,-1))]),(0,s.Lk)("div",ct,[t[6]||(t[6]=(0,s.Lk)("i",{class:"fas fa-user user-image"},null,-1)),(0,s.Lk)("span",null,(0,r.v_)(o.user?`${o.user.firstName} ${o.user.lastName}`:"John Doe"),1)]),(0,s.Lk)("div",ut,[t[7]||(t[7]=(0,s.Lk)("i",{class:"fas fa-right-from-bracket user-signofficon"},null,-1)),(0,s.Lk)("span",{onClick:t[2]||(t[2]=(...e)=>l.handleLogout&&l.handleLogout(...e))},"Afmelden")])]),i.showPopup?((0,s.uX)(),(0,s.CE)("div",dt,[(0,s.Lk)("div",ht,[(0,s.Lk)("p",null,(0,r.v_)(this.translations.barcodeNotFound),1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.closePopup&&l.closePopup(...e))},"Sluiten")])])):(0,s.Q3)("",!0)])}var kt={name:"HeaderComponent",props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},disableFocus:{type:Boolean,default:!1},token:{type:String,required:!0},user:{type:Object,default:()=>null}},data(){return{barcodeInput:"",showPopup:!1,debouncedOnBarcodeInput:null,focusInterval:null}},watch:{disableFocus(e){e?clearInterval(this.focusInterval):this.focusInterval=setInterval(this.maintainFocus,100)}},methods:{debounce(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout((()=>e.apply(this,n)),t)}},async fetchProduct(e,t="BARCODE"){try{const o=await f.A.post(`${this.apiBaseUrl}/products/find`,{type:t,term:e},{headers:{Authorization:`Bearer ${this.token}`}}),n=o.data;return"success"===n.status&&n.data.length>0?n.data:null}catch(o){return console.error("Error fetching product:",o),this.showPopup=!0,null}},async onBarcodeInput(){const e=this.barcodeInput.trim();if(!e)return;let t;this.showPopup=!1,t=/^\d+$/.test(e)?12===e.length||13===e.length?"BARCODE":"ALL":e.match(/^[a-zA-Z0-9-]+$/)?"REFERENCE":"NAME";const o=await this.fetchProduct(e,t);if(o&&o.length>0){const e=o[0];this.$emit("product-scanned",e),this.barcodeInput=""}else this.showPopup=!0},closePopup(){this.showPopup=!1,this.barcodeInput=""},maintainFocus(){this.disableFocus||this.$refs.searchInput.focus()},handleLogout(){this.$emit("logout")}},mounted(){this.focusInterval=setInterval(this.maintainFocus,100),this.debouncedOnBarcodeInput=this.debounce(this.onBarcodeInput,100)},beforeUnmount(){clearInterval(this.focusInterval)}};const mt=(0,v.A)(kt,[["render",pt]]);var yt=mt;const ft={class:"sidebar"},gt={class:"main-links"};function vt(e,t,o,n,a,r){const i=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("aside",ft,[(0,s.Lk)("nav",null,[(0,s.Lk)("ul",gt,[(0,s.Lk)("li",null,[(0,s.bF)(i,{to:"/index.html"},{default:(0,s.k6)((()=>t[0]||(t[0]=[(0,s.Lk)("i",{class:"fas fa-home"},null,-1),(0,s.Lk)("span",null,"Home",-1)]))),_:1})]),t[2]||(t[2]=(0,s.Lk)("li",null,[(0,s.Lk)("a",{href:"#"},[(0,s.Lk)("i",{class:"fas fa-users"}),(0,s.Lk)("span",null,"Klanten")])],-1)),(0,s.Lk)("li",null,[(0,s.bF)(i,{to:"/bestellingen"},{default:(0,s.k6)((()=>t[1]||(t[1]=[(0,s.Lk)("i",{class:"fas fa-shopping-cart"},null,-1),(0,s.Lk)("span",null,"Bestellingen",-1)]))),_:1})]),t[3]||(t[3]=(0,s.Lk)("li",null,[(0,s.Lk)("a",{href:"#"},[(0,s.Lk)("i",{class:"fas fa-chart-bar"}),(0,s.Lk)("span",null,"Rapportage")])],-1))]),t[4]||(t[4]=(0,s.Lk)("div",{class:"help-section"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",null,[(0,s.Lk)("a",{href:"#"},[(0,s.Lk)("i",{class:"fas fa-question-circle"}),(0,s.Lk)("span",null,"Help")])])])],-1))])])}var Lt={name:"SidebarComponent"};const bt=(0,v.A)(Lt,[["render",vt]]);var Pt=bt;const Ct={key:0,class:"popup-overlay"},wt={class:"popup-message"};function It(e,t,o,n,a,i){return a.visible?((0,s.uX)(),(0,s.CE)("div",Ct,[(0,s.Lk)("div",wt,[(0,s.Lk)("p",null,(0,r.v_)(a.message),1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>i.closePopup&&i.closePopup(...e))},"Sluiten")])])):(0,s.Q3)("",!0)}var Et={data(){return{visible:!1,message:""}},methods:{showPopup(e){this.message=e,this.visible=!0},closePopup(){this.visible=!1}}};const _t=(0,v.A)(Et,[["render",It]]);var Tt=_t,Ot={components:{LoginComponent:ee,CashRegister:rt,HeaderComponent:yt,SidebarComponent:Pt,ErrorPopup:Tt},watch:{token(e){e?this.setupInactivityListener():this.cleanupInactivityListener()}},props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0}},data(){return{orderItems:[],token:null,user:null,disableFocus:!1,inactivityTimeout:null,tokenExpirationTime:null,tokenExchangeTimeout:null}},methods:{async fetchCurrentOrder(){try{const e=await f.A.get(`${this.apiBaseUrl}/orders/current`,{headers:{Authorization:`Bearer ${this.token}`}}),t=e.data?.data?.cart;t&&Array.isArray(t.lines)?this.orderItems=t.lines.map((e=>({product_id:e.product_id,refcode:e.reference,name:e.name,price_tax_incl:e.price_tax_incl,price_tax_excl:e.price_tax_excl,quantity:e.quantity,image_url:e.image_url}))):(console.warn("No cart or lines data available in the response."),this.orderItems=[])}catch(e){console.error("Error fetching current order:",e)}},async addProductToOrder(e){let t=this.orderItems.find((t=>t.refcode===e.refcode));if(t&&t.quantity+1>e.stock)alert(`Cannot add more than available stock of ${e.stock}`);else if(!t&&e.stock<1)alert(this.translations.outOfStock);else try{const o=await f.A.post(`${this.apiBaseUrl}/orders/add-product-to-order`,{refcode:e.refcode,quantity:1},{headers:{Authorization:`Bearer ${this.token}`}});if("fail"===o.data.status&&"OUT_OF_STOCK"===o.data.data.code){const e=o.data.data.quantityAvailable;return alert(`Only ${e} items are available in stock. Please adjust your quantity.`),void(t&&(t.quantity=e))}t?t.quantity+=1:this.orderItems.push({...e,quantity:1}),console.log("Updated order summary:",o.data)}catch(o){o.response&&422===o.response.status?this.$refs.errorPopup.showPopup(this.translations.outOfStock):console.error("Error adding product to order:",o)}},async removeProductFromOrder(e){const t=[...this.orderItems];this.orderItems=this.orderItems.filter((t=>t.refcode!==e));try{const o=await f.A.post(`${this.apiBaseUrl}/orders/delete-product-from-order`,{refcode:e},{headers:{Authorization:`Bearer ${this.token}`}});"success"===o.data.status?console.log("Item successfully deleted from the order."):"fail"===o.data.status&&(this.handleError(o.data.data),this.orderItems=t)}catch(o){console.error("Error removing product from order:",o),this.orderItems=t}},async updateItemQuantity({refcode:e,quantity:t}){const o=this.orderItems.findIndex((t=>t.refcode===e));if(-1!==o){const a=this.orderItems[o],s=a.quantity+t;if(s<=0)return void this.removeProductFromOrder(e);if(s>a.stock)return void alert(`Cannot update quantity. Available stock is ${a.stock}.`);try{const t=await f.A.post(`${this.apiBaseUrl}/orders/change-quantity`,{refcode:e,quantity:s},{headers:{Authorization:`Bearer ${this.token}`}});if("fail"===t.data.status&&"OUT_OF_STOCK"===t.data.data.code){const e=t.data.data.quantityAvailable;return alert(`Only ${e} items are available in stock. Please adjust your quantity.`),void(a.quantity=e)}a.quantity=s,console.log("Updated order summary:",t.data),this.updateTotalPrice()}catch(n){n.response&&422===n.response.status?this.$refs.errorPopup.showPopup(this.translations.outOfStock):console.error("Error updating product quantity:",n)}}else console.error(`Item with refcode ${e} not found in the order.`)},async setItemQuantity({refcode:e,setQuantity:t}){const o=this.orderItems.findIndex((t=>t.refcode===e));if(-1!==o){const a=this.orderItems[o];if(t>a.stock)return void this.$refs.errorPopup.showPopup(`Requested quantity of ${t} exceeds available stock of ${a.stock}.`);try{const o=await f.A.post(`${this.apiBaseUrl}/orders/change-quantity`,{refcode:e,quantity:t},{headers:{Authorization:`Bearer ${this.token}`}});if("fail"===o.data.status&&"OUT_OF_STOCK"===o.data.data.code){const e=o.data.data.quantityAvailable;return this.$refs.errorPopup.showPopup(`Only ${e} items are available. Adjusting quantity to available stock.`),void(a.quantity=e)}a.quantity=t,console.log("Quantity successfully updated:",o.data)}catch(n){n.response&&422===n.response.status?this.$refs.errorPopup.showPopup(this.translations.outOfStock):console.error("Error updating quantity:",n)}}else console.error(`Item with refcode ${e} not found in the order.`)},clearOrderItems(){this.orderItems=[]},updateModalState(e){this.disableFocus=e},updateFocusState(e){this.disableFocus=e},logout(){this.clearTokenData()},resetInactivityTimer(){this.inactivityTimeout&&clearTimeout(this.inactivityTimeout),this.inactivityTimeout=setTimeout((()=>{this.logout()}),9e5)},setupInactivityListener(){const e=["mousemove","keydown","click","scroll"];e.forEach((e=>{window.addEventListener(e,this.resetInactivityTimer)})),this.resetInactivityTimer()},cleanupInactivityListener(){this.inactivityTimeout&&clearTimeout(this.inactivityTimeout);const e=["mousemove","keydown","click","scroll"];e.forEach((e=>{window.removeEventListener(e,this.resetInactivityTimer)}))},async setToken(e,t=!1){try{const o=await f.A.get(`${this.apiBaseUrl}/token`,{headers:{Authorization:`Bearer ${e}`}});if("success"===o.data.status){const{firstname:n,lastname:a,token:s}=o.data.data,{expiresIn:r}=s;return this.token=e,this.user={firstName:n,lastName:a},console.log("ExpiresIn received:",r),console.log("Full API response:",o.data),this.tokenExpirationTime=Date.now()+1e3*r,localStorage.setItem("authToken",e),localStorage.setItem("userFirstName",n),localStorage.setItem("userLastName",a),localStorage.setItem("tokenExpirationTime",this.tokenExpirationTime),t||this.scheduleTokenExchange(r),!0}}catch(o){console.error("Error validating token:",o)}return this.clearTokenData(),!1},scheduleTokenExchange(e){if(!e||isNaN(e))return void console.error("Invalid expiresIn value. Cannot schedule token exchange.");const t=1e3*(e-300);if(t<=0)return console.warn("Token has less than 60 seconds. Exchanging immediately."),void this.exchangeToken();this.tokenExchangeTimeout&&clearTimeout(this.tokenExchangeTimeout),this.tokenExchangeTimeout=setTimeout((()=>{this.exchangeToken()}),t),console.log(`Token exchange scheduled in ${(t/1e3).toFixed(1)} seconds.`)},async exchangeToken(){try{const e=await f.A.post(`${this.apiBaseUrl}/token/exchange`,{},{headers:{Authorization:`Bearer ${this.token}`}});if(200===e.status){const t=e.data.data.token.value;console.log("Token exchanged successfully."),await this.setToken(t,!0)}else console.warn("Token exchange failed. Logging out."),this.logout()}catch(e){console.error("Error exchanging token:",e),this.logout()}},clearTokenData(){this.token=null,this.user=null,this.tokenExpirationTime=null,localStorage.removeItem("authToken"),localStorage.removeItem("userFirstName"),localStorage.removeItem("userLastName"),localStorage.removeItem("tokenExpirationTime"),this.tokenExchangeTimeout&&clearTimeout(this.tokenExchangeTimeout)},handleError(e){switch(e.code){case"NOT_FOUND":console.error("Product not found:",e.message);break;case"BAD_REQUEST":console.error("Bad request:",e.message);break;case"OUT_OF_STOCK":console.error("Out of stock:",e.message),alert("This product is currently out of stock.");break;case"MINIMAL_QUANTITY_REQUIRED":console.error("Minimum quantity required:",e.message);break;default:console.error("An unknown error occurred.")}}},mounted(){const e=localStorage.getItem("authToken"),t=parseInt(localStorage.getItem("tokenExpirationTime"),10);if(e&&t>Date.now()){const o=(t-Date.now())/1e3;this.setToken(e).then((e=>{e?(this.scheduleTokenExchange(o),this.fetchCurrentOrder()):(console.warn("Stored token is invalid. Logging out."),this.logout())}))}else console.warn("No valid token found. Redirecting to login."),this.logout();this.token&&(this.fetchCurrentOrder(),this.setupInactivityListener())},beforeUnmount(){this.tokenExchangeTimeout&&clearTimeout(this.tokenExchangeTimeout),this.cleanupInactivityListener()}};const xt=(0,v.A)(Ot,[["render",N]]);var At=xt;window.startPOS=(e,t)=>{const o=(0,n.Ef)(At,t);o.use(D),o.mount(e)}}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,o),s.exports}o.m=e,function(){var e=[];o.O=function(t,n,a,s){if(!n){var r=1/0;for(u=0;u<e.length;u++){n=e[u][0],a=e[u][1],s=e[u][2];for(var i=!0,l=0;l<n.length;l++)(!1&s||r>=s)&&Object.keys(o.O).every((function(e){return o.O[e](n[l])}))?n.splice(l--,1):(i=!1,s<r&&(r=s));if(i){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,a,s]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,s,r=n[0],i=n[1],l=n[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(l)var u=l(o)}for(t&&t(n);c<r.length;c++)s=r[c],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return o.O(u)},n=self["webpackChunkpossystem"]=self["webpackChunkpossystem"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(1619)}));n=o.O(n)})();
//# sourceMappingURL=app.js.map