(function(){"use strict";var e={1987:function(e,t,n){var s=n(5130),o=n(1387),a=(n(4114),n(6768)),r=n(4232);const i={class:"order-overview-container"},l={class:"search-bar-order-overview mb-3"},c={class:"input-group"},u={key:0},d={key:1},h={class:"table table-striped"},p=["onClick"],k={class:"pagination justify-content-center"},m=["onClick"];function g(e,t,n,o,g,y){return(0,a.uX)(),(0,a.CE)("div",i,[t[9]||(t[9]=(0,a.Lk)("h2",{class:"order-title"},"Bestellingen",-1)),(0,a.Lk)("div",l,[(0,a.Lk)("div",c,[(0,a.bo)((0,a.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>g.searchQuery=e),placeholder:"Zoek op ID, Referentie, Klant of Datum",onFocus:t[1]||(t[1]=t=>e.$emit("focus-state-change",!0)),onBlur:t[2]||(t[2]=t=>e.$emit("focus-state-change",!1)),onInput:t[3]||(t[3]=(...e)=>y.onSearchInput&&y.onSearchInput(...e))},null,544),[[s.Jo,g.searchQuery]]),t[6]||(t[6]=(0,a.Lk)("span",{class:"input-group-text"},[(0,a.Lk)("i",{class:"fas fa-search"})],-1))])]),0===y.filteredOrders.length?((0,a.uX)(),(0,a.CE)("div",u,t[7]||(t[7]=[(0,a.Lk)("p",null,"Geen bestellingen gevonden.",-1)]))):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("table",h,[t[8]||(t[8]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"#"),(0,a.Lk)("th",null,"Referentie"),(0,a.Lk)("th",null,"Klant"),(0,a.Lk)("th",null,"Betaling"),(0,a.Lk)("th",null,"Datum"),(0,a.Lk)("th",null,"Totaal")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(y.paginatedOrders.filter((e=>e)),(t=>((0,a.uX)(),(0,a.CE)("tr",{key:t.id,onClick:n=>e.$router.push({name:"OrderDetails",params:{id:t.id}}),style:{cursor:"pointer"}},[(0,a.Lk)("td",null,(0,r.v_)(t.id),1),(0,a.Lk)("td",null,(0,r.v_)(t.reference),1),(0,a.Lk)("td",null,(0,r.v_)(t.customer),1),(0,a.Lk)("td",null,(0,r.v_)(t.payment_method),1),(0,a.Lk)("td",null,(0,r.v_)(t.date),1),(0,a.Lk)("td",null,"€"+(0,r.v_)((t.total_tax_incl||0).toFixed(2)),1)],8,p)))),128))])]),(0,a.Lk)("nav",null,[(0,a.Lk)("ul",k,[(0,a.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:1===g.currentPage}])},[(0,a.Lk)("button",{class:"page-link",onClick:t[4]||(t[4]=e=>y.goToPage(g.currentPage-1))}," Vorige ")],2),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(y.pageRange,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e,class:(0,r.C4)(["page-item",{active:e===g.currentPage}])},[(0,a.Lk)("button",{class:"page-link",onClick:t=>y.goToPage(e)},(0,r.v_)(e),9,m)],2)))),128)),(0,a.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:g.currentPage===y.totalPages}])},[(0,a.Lk)("button",{class:"page-link",onClick:t[5]||(t[5]=e=>y.goToPage(g.currentPage+1))}," Volgende ")],2)])])]))])}var y=n(4373),f={name:"OrderOverview",props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},token:{type:String,required:!0}},data(){return{orders:[],searchQuery:"",currentPage:1,ordersPerPage:8,totalItems:0}},computed:{filteredOrders(){if(this.searchQuery){const e=this.searchQuery.toLowerCase();return this.orders.filter((t=>t.id.toString().includes(e)||t.reference.toLowerCase().includes(e)||t.customer.toLowerCase().includes(e)||t.date.toLowerCase().includes(e)))}return this.orders},totalPages(){return Math.ceil(this.totalItems/this.ordersPerPage)},pageRange(){let e=[];const t=10,n=Math.max(1,this.currentPage-4),s=Math.min(this.totalPages,n+t-1);for(let o=n;o<=s;o++)e.push(o);return e},paginatedOrders(){return this.filteredOrders}},mounted(){this.fetchOrders()},methods:{async fetchOrders(){try{const e=await y.A.get(`${this.apiBaseUrl}/orders`,{headers:{Authorization:`Bearer ${this.token}`},params:{searchterm:this.searchQuery,page:this.currentPage,per_page:this.ordersPerPage}});console.log("API Response:",e.data),this.orders=e.data.data.list,this.totalItems=e.data.data.pagination.total_items,console.log("Orders for Page:",this.currentPage,this.orders)}catch(e){console.error("Fout bij het ophalen van bestellingen:",e)}},onSearchInput(){this.currentPage=1,this.fetchOrders()},goToPage(e){e>0&&e<=this.totalPages&&(this.currentPage=e,this.fetchOrders())}}},v=n(1241);const L=(0,v.A)(f,[["render",g]]);var b=L;const C={class:"order-details-container"},P={key:0,class:"order-details-content"},w={class:"d-flex justify-content-between align-items-center"},I={class:"table"},E={key:0},_={class:"table"},T=["src"],O={key:1},x={key:1};function S(e,t,n,o,i,l){return(0,a.uX)(),(0,a.CE)("div",C,[i.order?((0,a.uX)(),(0,a.CE)("div",P,[(0,a.Lk)("div",w,[(0,a.Lk)("h2",null,"Bestelgegevens - ID: "+(0,r.v_)(i.order.id),1),(0,a.Lk)("button",{class:"print-order-btn btn",onClick:t[0]||(t[0]=(...e)=>l.handlePrint&&l.handlePrint(...e))},t[7]||(t[7]=[(0,a.Lk)("i",{class:"fas fa-print me-2"},null,-1),(0,a.eW)(" Print Bestelling ")]))]),(0,a.Lk)("table",I,[t[8]||(t[8]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Referentie"),(0,a.Lk)("th",null,"Klant"),(0,a.Lk)("th",null,"Datum"),(0,a.Lk)("th",null,"Totaal")])],-1)),(0,a.Lk)("tbody",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("td",null,(0,r.v_)(i.order.reference),1),(0,a.Lk)("td",null,(0,r.v_)(i.order.customer||"Geen klantinformatie"),1),(0,a.Lk)("td",null,(0,r.v_)(i.order.date),1),(0,a.Lk)("td",null,"€"+(0,r.v_)(i.order.total_tax_incl.toFixed(2)),1)])])]),t[12]||(t[12]=(0,a.Lk)("h3",null,"Gekochte artikelen",-1)),i.order.lines&&i.order.lines.length>0?((0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("table",_,[t[9]||(t[9]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Afbeelding"),(0,a.Lk)("th",null,"Naam"),(0,a.Lk)("th",null,"Referentie"),(0,a.Lk)("th",null,"Aantal"),(0,a.Lk)("th",null,"Prijs")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.order.lines,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.product_id},[(0,a.Lk)("td",null,[(0,a.Lk)("img",{src:e.image_url,alt:"Product afbeelding",style:{"max-width":"50px"}},null,8,T)]),(0,a.Lk)("td",null,(0,r.v_)(e.name),1),(0,a.Lk)("td",null,(0,r.v_)(e.reference),1),(0,a.Lk)("td",null,(0,r.v_)(e.quantity),1),(0,a.Lk)("td",null,"€"+(0,r.v_)(e.price_tax_incl.toFixed(2)),1)])))),128))])])])):((0,a.uX)(),(0,a.CE)("div",O,t[10]||(t[10]=[(0,a.Lk)("p",null,"Geen artikelen gevonden in deze bestelling.",-1)]))),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.goToOrderOverview&&l.goToOrderOverview(...e)),class:"back-to-orders-btn btn mt-3"},t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-arrow-left me-1"},null,-1),(0,a.eW)(" Terug naar Bestellingen ")]))])):((0,a.uX)(),(0,a.CE)("div",x,t[13]||(t[13]=[(0,a.Lk)("p",null,"Bezig met het laden van Bestelgegevens...",-1)]))),i.showPopup?((0,a.uX)(),(0,a.CE)("div",{key:2,class:"popup-overlay",onClick:t[6]||(t[6]=(...e)=>l.closePopup&&l.closePopup(...e))},[(0,a.Lk)("div",{class:"popup-message",onClick:t[5]||(t[5]=(0,s.D$)((()=>{}),["stop"]))},[t[14]||(t[14]=(0,a.Lk)("h3",null,"Kies het type document:",-1)),(0,a.Lk)("button",{onClick:t[2]||(t[2]=e=>l.printDocument("INVOICE"))},"Factuur"),(0,a.Lk)("button",{onClick:t[3]||(t[3]=e=>l.printDocument("RECEIPT"))},"Bon"),(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.closePopup&&l.closePopup(...e))},"Annuleren")])])):(0,a.Q3)("",!0)])}var $={name:"OrderDetails",props:{id:{type:String,required:!0},apiBaseUrl:{type:String,required:!0},token:{type:String,required:!0}},data(){return{order:null,showPopup:!1}},mounted(){this.fetchOrderDetails()},methods:{async fetchOrderDetails(){try{const e=await y.A.get(`${this.apiBaseUrl}/orders/${this.id}`,{headers:{Authorization:`Bearer ${this.token}`}});this.order=e.data.data||null}catch(e){console.error("Fout bij het ophalen van orderdetails:",e),this.order=null}},handlePrint(){this.showPopup=!0},closePopup(){this.showPopup=!1},async printDocument(e){if(this.order&&this.order.id)try{const t=await y.A.post(`${this.apiBaseUrl}/orders/print-document`,{order_id:this.order.id,print_type:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});console.log("Printen succesvol:",t.data),alert("Document succesvol geprint!"),this.closePopup()}catch(t){console.error("Fout bij het printen:",t.response?.data||t),alert("Er is een fout opgetreden bij het printen van het document."),this.closePopup()}else console.error("Fout: Geen order ID beschikbaar.")},goToOrderOverview(){this.$router.push({name:"Bestellingen"})}}};const A=(0,v.A)($,[["render",S]]);var B=A;const q={class:"client-overview"},F={class:"mb-3"},D={class:"input-group"},U={key:0},M={class:"client-list"},Q=["onClick"],X={class:"client-name"},R={class:"client-email"},j={key:0,class:"client-details"},K={class:"pagination justify-content-center"},N=["onClick"];function W(e,t,n,o,i,l){return(0,a.uX)(),(0,a.CE)("div",q,[t[9]||(t[9]=(0,a.Lk)("h2",{class:"client-title"},"Klanten",-1)),(0,a.Lk)("div",F,[(0,a.Lk)("div",D,[(0,a.bo)((0,a.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>i.searchQuery=e),placeholder:"Zoek op Naam, Emailadres of Adres",onFocus:t[1]||(t[1]=t=>e.$emit("focus-state-change",!0)),onBlur:t[2]||(t[2]=t=>e.$emit("focus-state-change",!1)),onInput:t[3]||(t[3]=(...e)=>l.onSearchInput&&l.onSearchInput(...e))},null,544),[[s.Jo,i.searchQuery]]),t[6]||(t[6]=(0,a.Lk)("span",{class:"input-group-text"},[(0,a.Lk)("i",{class:"fas fa-search"})],-1))])]),0===l.filteredClients.length?((0,a.uX)(),(0,a.CE)("div",U,t[7]||(t[7]=[(0,a.Lk)("p",null,"Geen klanten gevonden.",-1)]))):(0,a.Q3)("",!0),(0,a.Lk)("ul",M,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.clients,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e.id,class:(0,r.C4)({"client-item":!0,expanded:i.expandedClient===e.id}),onClick:t=>l.toggleDetails(e,e.id)},[(0,a.Lk)("p",X,(0,r.v_)(e.firstname)+" "+(0,r.v_)(e.lastname),1),(0,a.Lk)("p",R,(0,r.v_)(e.email),1),i.expandedClient===e.id?((0,a.uX)(),(0,a.CE)("div",j,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.addresses,((n,s)=>((0,a.uX)(),(0,a.CE)("div",{key:n.id},[(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,"Adres "+(0,r.v_)(e.addresses.length>1?s+1:"")+":",1),(0,a.eW)(" "+(0,r.v_)(n.address1)+", "+(0,r.v_)(n.city)+", "+(0,r.v_)(n.country),1)]),(0,a.Lk)("p",null,[t[8]||(t[8]=(0,a.Lk)("strong",null,"Telefoonnummer:",-1)),(0,a.eW)(" "+(0,r.v_)(n.phone),1)])])))),128))])):(0,a.Q3)("",!0)],10,Q)))),128))]),(0,a.Lk)("nav",null,[(0,a.Lk)("ul",K,[(0,a.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:1===i.currentPage}])},[(0,a.Lk)("button",{class:"page-link",onClick:t[4]||(t[4]=e=>l.goToPage(i.currentPage-1))}," Vorige ")],2),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.pageRange,(e=>((0,a.uX)(),(0,a.CE)("li",{key:e,class:(0,r.C4)(["page-item",{active:e===i.currentPage}])},[(0,a.Lk)("button",{class:"page-link",onClick:t=>l.goToPage(e)},(0,r.v_)(e),9,N)],2)))),128)),(0,a.Lk)("li",{class:(0,r.C4)(["page-item",{disabled:i.currentPage===l.totalPages}])},[(0,a.Lk)("button",{class:"page-link",onClick:t[5]||(t[5]=e=>l.goToPage(i.currentPage+1))}," Volgende ")],2)])])])}var z={name:"ClientOverview",props:{apiBaseUrl:{type:String,required:!0},token:{type:String,required:!0}},data(){return{searchQuery:"",expandedClient:null,clients:[],currentPage:1,clientsPerPage:5,totalClients:0}},computed:{filteredClients(){if(this.searchQuery){const e=this.searchQuery.toLowerCase();return this.clients.filter((t=>t.id.toString().includes(e)||t.firstname.toLowerCase().includes(e)||t.lastname.toLowerCase().includes(e)||t.email.toLowerCase().includes(e)||t.addresses.some((t=>t.address1.toLowerCase().includes(e)||t.city.toLowerCase().includes(e)||t.country.toLowerCase().includes(e)||t.phone.toLowerCase().includes(e)))))}return this.clients},totalPages(){return Math.max(1,Math.ceil(this.totalClients/this.clientsPerPage))},pageRange(){if(0===this.totalPages)return[1];let e=[];const t=10,n=Math.max(1,this.currentPage-4),s=Math.min(this.totalPages,n+t-1);for(let o=n;o<=s;o++)e.push(o);return e},paginatedClients(){return this.filteredClients}},methods:{async fetchClients(){try{const e=await y.A.get(`${this.apiBaseUrl}/clients`,{params:{searchterm:this.searchQuery,page:this.currentPage,per_page:this.clientsPerPage},headers:{Authorization:`Bearer ${this.token}`}});"success"===e.data.status&&(this.clients=e.data.data.list,this.totalClients=e.data.data.pagination.total_items)}catch(e){console.error("Error fetching clients:",e)}},async toggleDetails(e,t){const n=this.expandedClient===t?null:t;try{const e=await y.A.post(`${this.apiBaseUrl}/orders/assign-client`,{client_id:n},{headers:{Authorization:`Bearer ${this.token}`}});"success"===e.data.status&&this.$emit("client-assigned",n)}catch(s){console.error("Error assigning client:",s)}this.expandedClient=n,this.$emit("client-selected",n?e:null)},onSearchInput(){this.currentPage=1,this.fetchClients()},goToPage(e){e>0&&e<=this.totalPages&&(this.currentPage=e,this.fetchClients())}},mounted(){this.fetchClients()}};const V=(0,v.A)(z,[["render",W]]);var J=V;const G=[{path:"/index.html",name:"Home",props:!0},{path:"/bestellingen",name:"Bestellingen",component:b},{path:"/bestellingen/:id",name:"OrderDetails",component:B,props:!0},{path:"/klanten",name:"Klanten",component:J}],H=(0,o.aE)({history:(0,o.Bt)(),routes:G});var Z=H;const Y={key:1},ee={class:"container-fluid main-content"},te={class:"row"},ne={class:"col-2"},se={class:"col-5",style:{padding:"20px"}},oe={class:"col-5"};function ae(e,t,n,s,o,r){const i=(0,a.g2)("LoginComponent"),l=(0,a.g2)("HeaderComponent"),c=(0,a.g2)("SidebarComponent"),u=(0,a.g2)("router-view"),d=(0,a.g2)("CashRegister"),h=(0,a.g2)("ErrorPopup");return(0,a.uX)(),(0,a.CE)("div",null,[o.token?((0,a.uX)(),(0,a.CE)("div",Y,[(0,a.bF)(l,{"api-base-url":n.apiBaseUrl,translations:n.translations,"disable-focus":o.disableFocus,token:o.token,user:o.user,onProductScanned:r.addProductToOrder,onLogout:r.logout},null,8,["api-base-url","translations","disable-focus","token","user","onProductScanned","onLogout"]),(0,a.Lk)("div",ee,[(0,a.Lk)("div",te,[(0,a.Lk)("div",ne,[(0,a.bF)(c)]),(0,a.Lk)("div",se,[(0,a.bF)(u,{"api-base-url":n.apiBaseUrl,orderItems:o.orderItems,translations:n.translations,token:o.token,onFocusStateChange:r.updateFocusState,onClientSelected:r.handleClientSelection},null,8,["api-base-url","orderItems","translations","token","onFocusStateChange","onClientSelected"])]),(0,a.Lk)("div",oe,[(0,a.bF)(d,{"api-base-url":n.apiBaseUrl,orderItems:o.orderItems,translations:n.translations,token:o.token,selectedClient:o.selectedClient,onRemoveItem:r.removeProductFromOrder,onUpdateQuantity:r.updateItemQuantity,onSetQuantity:r.setItemQuantity,onClearOrderItems:r.clearOrderItems,onClearSelectedClient:t[0]||(t[0]=e=>o.selectedClient=null),onModalStateChange:r.updateModalState},null,8,["api-base-url","orderItems","translations","token","selectedClient","onRemoveItem","onUpdateQuantity","onSetQuantity","onClearOrderItems","onModalStateChange"])])])]),(0,a.bF)(h,{ref:"errorPopup"},null,512)])):((0,a.uX)(),(0,a.Wv)(i,{key:0,"api-base-url":n.apiBaseUrl,translations:n.translations,onLoginSuccess:r.setToken},null,8,["api-base-url","translations","onLoginSuccess"]))])}const re={class:"login-container"},ie={class:"form-group"},le={class:"form-group"},ce={class:"form-group"},ue=["value"],de={key:0,class:"error-message"};function he(e,t,n,o,i,l){return(0,a.uX)(),(0,a.CE)("div",re,[t[8]||(t[8]=(0,a.Lk)("h2",{class:"login-title"},"Login",-1)),(0,a.Lk)("form",{onSubmit:t[3]||(t[3]=(0,s.D$)(((...e)=>l.handleLogin&&l.handleLogin(...e)),["prevent"])),class:"login-form"},[(0,a.Lk)("div",ie,[t[4]||(t[4]=(0,a.Lk)("label",{for:"username",class:"form-label"},"Gebruikersnaam",-1)),(0,a.bo)((0,a.Lk)("input",{id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),type:"text",placeholder:"Gebruikersnaam",class:"form-input",required:""},null,512),[[s.Jo,i.username]])]),(0,a.Lk)("div",le,[t[5]||(t[5]=(0,a.Lk)("label",{for:"password",class:"form-label"},"Wachtwoord",-1)),(0,a.bo)((0,a.Lk)("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),type:"password",placeholder:"Wachtwoord",class:"form-input",required:""},null,512),[[s.Jo,i.password]])]),(0,a.Lk)("div",ce,[t[6]||(t[6]=(0,a.Lk)("label",{for:"workstation",class:"form-label"},"Kassa",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.workstationId=e),id:"workstation",class:"form-select",required:""},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.workstations,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id},(0,r.v_)(e.name),9,ue)))),128))],512),[[s.u1,i.workstationId]])]),t[7]||(t[7]=(0,a.Lk)("button",{type:"submit",class:"login-button"},"Inloggen",-1))],32),i.errorMessage?((0,a.uX)(),(0,a.CE)("p",de,(0,r.v_)(i.errorMessage),1)):(0,a.Q3)("",!0)])}var pe={data(){return{username:"",password:"",role:"cashier",workstationId:null,workstations:[],errorMessage:""}},async created(){try{const e=await y.A.get(`${this.$props.apiBaseUrl}/workstations`);this.workstations=e.data.data;const t=localStorage.getItem("lastWorkstationId");t&&this.workstations.some((e=>e.id===t))&&(this.workstationId=t)}catch(e){this.errorMessage="Failed to load workstations."}},methods:{async handleLogin(){try{if(!this.workstationId)return void(this.errorMessage="Please select a workstation.");const e=await y.A.post(`${this.$props.apiBaseUrl}/users`,{username:this.username,password:this.password,role:this.role,workstationId:this.workstationId}),{token:t,expiresIn:n}=e.data.data;console.log("Token received from login:",t),localStorage.setItem("lastWorkstationId",this.workstationId);const s=Date.now()+1e3*n;localStorage.setItem("tokenExpirationTime",s),this.$emit("login-success",t.value)}catch(e){this.errorMessage=this.translations.loginFailed,console.error("Login error:",e)}}},props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0}}};const ke=(0,v.A)(pe,[["render",he]]);var me=ke;function ge(e,t,n,s,o,r){const i=(0,a.g2)("OrderSummary");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(i,{"api-base-url":n.apiBaseUrl,orderItems:n.orderItems,translations:n.translations,token:n.token,selectedClient:n.selectedClient,onRemoveItem:r.removeProductFromOrder,onUpdateQuantity:r.updateItemQuantity,onSetQuantity:r.setItemQuantity,onClearOrderItems:r.forwardClearOrderItems,onClearSelectedClient:r.forwardClearSelectedClient,onModalStateChange:r.forwardModalStateChange},null,8,["api-base-url","orderItems","translations","token","selectedClient","onRemoveItem","onUpdateQuantity","onSetQuantity","onClearOrderItems","onClearSelectedClient","onModalStateChange"])])}const ye={class:"order-summary"},fe={ref:"orderList",class:"order-items-list"},ve=["onClick"],Le=["src","alt"],be={class:"item-details"},Ce={class:"item-header"},Pe={class:"product-name"},we={class:"product-price"},Ie={class:"product-price1"},Ee={class:"quantity-controls"},_e=["onClick"],Te={class:"quantity-wrapper"},Oe={key:2,class:"quantity-counter"},xe=["onClick"],Se=["onClick"],$e={class:"bottom-section"},Ae={class:"keyboard"},Be={class:"keyboard-row"},qe={class:"keyboard-row"},Fe={class:"keyboard-row"},De={class:"keyboard-row"},Ue={class:"customer-button"},Me={class:"summary-of-costs"},Qe={class:"cost-item"},Xe={class:"price"},Re={class:"cost-item"},je={key:0,class:"price"},Ke={class:"cost-item"},Ne={class:"price"},We={class:"cost-item-total"},ze={class:"total-price"},Ve={key:0,class:"popup-overlay"},Je={class:"popup-message"},Ge={class:"modal-content"},He={class:"order-items-scrollable"},Ze={class:"item-info"},Ye={class:"product-name1"},et={class:"product-quantity"},tt={class:"product-pricee"},nt={class:"total-price1"},st={class:"payment-methods"},ot={key:0,class:"cash-fields"},at=["value"],rt={key:1,class:"payment-warning"},it={key:2,class:"confirmation-popup-overlay"},lt={class:"confirmation-popup"},ct={key:3,class:"confirmation-popup-overlay"},ut={class:"confirmation-popup"},dt={id:"receipt-content",style:{display:"none"}},ht={class:"item-info"},pt={class:"product-name1"},kt={class:"product-quantity"},mt={class:"product-pricee"};function gt(e,t,n,o,i,l){return(0,a.uX)(),(0,a.CE)("div",ye,[t[54]||(t[54]=(0,a.Lk)("div",{class:"space",style:{height:"50px"}},null,-1)),(0,a.Lk)("div",fe,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.orderItems,(n=>((0,a.uX)(),(0,a.CE)("div",{key:n.refcode,class:(0,r.C4)(["order-item",{selected:i.selectedProduct&&i.selectedProduct.refcode===n.refcode}]),onClick:e=>l.selectProduct(n)},[(0,a.Lk)("img",{src:n.image_url,alt:n.name,class:"product-image"},null,8,Le),(0,a.Lk)("div",be,[(0,a.Lk)("div",Ce,[(0,a.Lk)("span",Pe,(0,r.v_)(n.name),1),(0,a.Lk)("span",we,[(0,a.eW)(" €"+(0,r.v_)(n.price_tax_incl?n.price_tax_incl.toFixed(2):"0.00")+" ",1),t[34]||(t[34]=(0,a.Lk)("span",{style:{"font-weight":"normal"}},"(incl. btw)",-1))]),(0,a.Lk)("span",Ie,[(0,a.eW)("€"+(0,r.v_)(n.price_tax_excl.toFixed(2))+" ",1),t[35]||(t[35]=(0,a.Lk)("span",{style:{"font-weight":"normal"}},"(excl. btw)",-1))])]),(0,a.Lk)("div",Ee,[(0,a.Lk)("button",{onClick:t=>e.$emit("update-quantity",{refcode:n.refcode,quantity:-1}),class:"quantity-button"},t[36]||(t[36]=[(0,a.Lk)("i",{class:"fa-solid fa-minus"},null,-1)]),8,_e),(0,a.Lk)("div",Te,[i.quantityEditable&&i.selectedProduct&&i.selectedProduct.refcode===n.refcode?(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=e=>i.editableQuantity=e),type:"number",class:"editable-quantity",onClick:t[1]||(t[1]=(0,s.D$)((()=>{}),["stop"]))},null,512)),[[s.Jo,i.editableQuantity]]):(0,a.Q3)("",!0),i.quantityEditable&&i.selectedProduct&&i.selectedProduct.refcode===n.refcode?((0,a.uX)(),(0,a.CE)("button",{key:1,onClick:t[2]||(t[2]=(...e)=>l.confirmQuantity&&l.confirmQuantity(...e)),class:"checkmark-button"},t[37]||(t[37]=[(0,a.Lk)("i",{class:"fa-solid fa-check"},null,-1)]))):((0,a.uX)(),(0,a.CE)("div",Oe,(0,r.v_)(n.quantity),1))]),(0,a.Lk)("button",{onClick:t=>e.$emit("update-quantity",{refcode:n.refcode,quantity:1}),class:"quantity-button"},t[38]||(t[38]=[(0,a.Lk)("i",{class:"fa-solid fa-plus"},null,-1)]),8,xe)])]),(0,a.Lk)("button",{onClick:e=>l.removeItem(n.refcode),class:"delete-button"},t[39]||(t[39]=[(0,a.Lk)("i",{class:"fa-solid fa-trash-can"},null,-1)]),8,Se)],10,ve)))),128)),t[40]||(t[40]=(0,a.Lk)("div",{class:"scroll-spacer"},null,-1))],512),(0,a.Lk)("div",$e,[(0,a.Lk)("div",Ae,[(0,a.Lk)("div",Be,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.setQuantityMode&&l.setQuantityMode(...e))},"Aant."),(0,a.Lk)("button",{onClick:t[4]||(t[4]=e=>l.handleKeyPress(1))},"1"),(0,a.Lk)("button",{onClick:t[5]||(t[5]=e=>l.handleKeyPress(2))},"2"),(0,a.Lk)("button",{onClick:t[6]||(t[6]=e=>l.handleKeyPress(3))},"3")]),(0,a.Lk)("div",qe,[(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>l.editFlatDiscount&&l.editFlatDiscount(...e))},"Prijs"),(0,a.Lk)("button",{onClick:t[8]||(t[8]=e=>l.handleKeyPress(4))},"4"),(0,a.Lk)("button",{onClick:t[9]||(t[9]=e=>l.handleKeyPress(5))},"5"),(0,a.Lk)("button",{onClick:t[10]||(t[10]=e=>l.handleKeyPress(6))},"6")]),(0,a.Lk)("div",Fe,[(0,a.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>l.editDiscount&&l.editDiscount(...e))},"%"),(0,a.Lk)("button",{onClick:t[12]||(t[12]=e=>l.handleKeyPress(7))},"7"),(0,a.Lk)("button",{onClick:t[13]||(t[13]=e=>l.handleKeyPress(8))},"8"),(0,a.Lk)("button",{onClick:t[14]||(t[14]=e=>l.handleKeyPress(9))},"9")]),(0,a.Lk)("div",De,[(0,a.Lk)("button",{onClick:t[15]||(t[15]=e=>l.handleKeyPress("delete"))},"Del"),t[41]||(t[41]=(0,a.Lk)("button",null,"+/-",-1)),(0,a.Lk)("button",{onClick:t[16]||(t[16]=e=>l.handleKeyPress(0))},"0"),(0,a.Lk)("button",{onClick:t[17]||(t[17]=e=>l.handleKeyPress("."))},".")]),(0,a.Lk)("button",Ue,[t[42]||(t[42]=(0,a.Lk)("div",{class:"user-icon"},[(0,a.Lk)("i",{class:"fas fa-user"})],-1)),(0,a.eW)(" "+(0,r.v_)(n.selectedClient?`${n.selectedClient.firstname} ${n.selectedClient.lastname}`:"Klant selecteren"),1)])]),(0,a.Lk)("div",Me,[(0,a.Lk)("div",Qe,[t[43]||(t[43]=(0,a.eW)(" Subtotaal ")),(0,a.Lk)("span",Xe,"€"+(0,r.v_)(l.subtotal.toFixed(2)),1)]),(0,a.Lk)("div",Re,[t[46]||(t[46]=(0,a.eW)(" Korting ")),i.discountEditable||i.flatDiscountEditable?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",je," €"+(0,r.v_)(l.discount.toFixed(2)),1)),(0,a.Lk)("div",{class:(0,r.C4)(["discount-input-wrapper",{hidden:!i.discountEditable}])},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.discountPercentage=e),type:"text",class:"discount-input",min:"0",max:"100",step:"1"},null,512),[[s.Jo,i.discountPercentage]]),(0,a.Lk)("button",{onClick:t[19]||(t[19]=e=>l.confirmDiscount("percentage")),class:"checkmark-button"},t[44]||(t[44]=[(0,a.Lk)("i",{class:"fa-solid fa-check"},null,-1)]))],2),(0,a.Lk)("div",{class:(0,r.C4)(["discount-input-wrapper",{hidden:!i.flatDiscountEditable}])},[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>i.flatDiscountAmount=e),type:"text",class:"discount-input",min:"0",step:"0.01"},null,512),[[s.Jo,i.flatDiscountAmount]]),(0,a.Lk)("button",{onClick:t[21]||(t[21]=e=>l.confirmDiscount("amount")),class:"checkmark-button"},t[45]||(t[45]=[(0,a.Lk)("i",{class:"fa-solid fa-check"},null,-1)]))],2)]),(0,a.Lk)("div",Ke,[t[47]||(t[47]=(0,a.eW)(" Btw ")),(0,a.Lk)("span",Ne,"€"+(0,r.v_)(l.vat.toFixed(2)),1)]),(0,a.Lk)("div",We,[t[48]||(t[48]=(0,a.eW)(" Totaalprijs ")),(0,a.Lk)("span",ze,"€"+(0,r.v_)(l.totalPrice.toFixed(2)),1)]),(0,a.Lk)("button",{class:"checkout-button",onClick:t[22]||(t[22]=(...e)=>l.openModal&&l.openModal(...e))}," Doorgaan naar afrekenen ")])]),i.showPopup?((0,a.uX)(),(0,a.CE)("div",Ve,[(0,a.Lk)("div",Je,[(0,a.Lk)("p",null,(0,r.v_)(this.translations.invalidDiscount),1),(0,a.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>l.closePopup&&l.closePopup(...e))},"Sluiten")])])):(0,a.Q3)("",!0),i.showModal?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"modal-overlay",onClick:t[29]||(t[29]=(0,s.D$)(((...e)=>l.closeModal&&l.closeModal(...e)),["self"]))},[(0,a.Lk)("div",Ge,[t[52]||(t[52]=(0,a.Lk)("h2",null,"Betalen",-1)),(0,a.Lk)("div",He,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.orderItems,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.refcode,class:"modal-order-item"},[(0,a.Lk)("div",Ze,[(0,a.Lk)("span",Ye,(0,r.v_)(e.name),1),(0,a.Lk)("span",et,"x"+(0,r.v_)(e.quantity),1),(0,a.Lk)("span",tt,"€"+(0,r.v_)(e.price_tax_incl.toFixed(2)),1)])])))),128))]),(0,a.Lk)("p",nt,"Totaalprijs: €"+(0,r.v_)(l.totalPrice.toFixed(2)),1),(0,a.Lk)("div",st,[t[51]||(t[51]=(0,a.Lk)("h3",null,"Selecteer Betaalmethode",-1)),(0,a.Lk)("label",null,[(0,a.bo)((0,a.Lk)("input",{type:"radio","onUpdate:modelValue":t[24]||(t[24]=e=>i.selectedPaymentMethod=e),value:"cash"},null,512),[[s.XL,i.selectedPaymentMethod]]),t[49]||(t[49]=(0,a.eW)(" Contant "))]),(0,a.Lk)("label",null,[(0,a.bo)((0,a.Lk)("input",{type:"radio","onUpdate:modelValue":t[25]||(t[25]=e=>i.selectedPaymentMethod=e),value:"card"},null,512),[[s.XL,i.selectedPaymentMethod]]),t[50]||(t[50]=(0,a.eW)(" Kaart "))]),"cash"===i.selectedPaymentMethod?((0,a.uX)(),(0,a.CE)("div",ot,[(0,a.bo)((0,a.Lk)("input",{type:"number","onUpdate:modelValue":t[26]||(t[26]=e=>i.cashReceived=e),class:"received-input",placeholder:"Ontvangen bedrag"},null,512),[[s.Jo,i.cashReceived,void 0,{number:!0}]]),(0,a.Lk)("input",{type:"text",class:"change-input",value:l.calculateChange,placeholder:"Wisselgeld",readonly:""},null,8,at)])):(0,a.Q3)("",!0),i.showPaymentWarning?((0,a.uX)(),(0,a.CE)("p",rt,(0,r.v_)(this.translations.paymentWarning),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>l.confirmCheckout&&l.confirmCheckout(...e)),class:"confirm-checkout-modal"}," Bevestig Betaling "),(0,a.Lk)("button",{onClick:t[28]||(t[28]=(...e)=>l.closeModal&&l.closeModal(...e)),class:"close-modal"},"Sluiten")])])):(0,a.Q3)("",!0),i.showPaymentConfirmation?((0,a.uX)(),(0,a.CE)("div",it,[(0,a.Lk)("div",lt,[(0,a.Lk)("p",null,(0,r.v_)(this.translations.paymentConfirmation),1),(0,a.Lk)("button",{onClick:t[30]||(t[30]=e=>l.handlePaymentConfirmation(!0))},"Ja"),(0,a.Lk)("button",{onClick:t[31]||(t[31]=e=>l.handlePaymentConfirmation(!1))},"Nee")])])):(0,a.Q3)("",!0),i.showReceiptPopup?((0,a.uX)(),(0,a.CE)("div",ct,[(0,a.Lk)("div",ut,[(0,a.Lk)("p",null,(0,r.v_)(this.translations.receiptConfirmation),1),(0,a.Lk)("button",{onClick:t[32]||(t[32]=e=>l.handleReceiptSelection(!0))},"Ja"),(0,a.Lk)("button",{onClick:t[33]||(t[33]=e=>l.handleReceiptSelection(!1))},"Nee")])])):(0,a.Q3)("",!0),(0,a.Lk)("div",dt,[t[53]||(t[53]=(0,a.Lk)("h2",null,"Receipt",-1)),(0,a.Lk)("p",null,"Total: €"+(0,r.v_)(l.totalPrice.toFixed(2)),1),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(n.orderItems,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.refcode,class:"modal-order-item"},[(0,a.Lk)("div",ht,[(0,a.Lk)("span",pt,(0,r.v_)(e.name),1),(0,a.Lk)("span",kt,"x"+(0,r.v_)(e.quantity),1),(0,a.Lk)("span",mt,"€"+(0,r.v_)(e.price_tax_incl.toFixed(2)),1)])])))),128))])])}var yt={data(){return{previousItemCount:0,selectedProduct:null,quantityMode:!1,quantityEditable:!1,editableQuantity:0,discountEditable:!1,flatDiscountEditable:!1,discountPercentage:0,flatDiscountAmount:0,previousDiscountPercentage:0,previousFlatDiscountAmount:0,newTotal:0,cashReceived:0,showPopup:!1,showModal:!1,selectedPaymentMethod:null,showPaymentWarning:!1,showPaymentConfirmation:!1,showReceiptPopup:!1}},props:{selectedClient:Object,orderItems:{type:Array,required:!0},apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},token:{type:String,required:!0}},watch:{orderItems:{handler(e){e.length>this.previousItemCount&&this.scrollToBottom(),this.previousItemCount=e.length},deep:!0},selectedPaymentMethod(e){"cash"===e&&(this.showPaymentWarning=!1)},showModal(e){this.$emit("modal-state-change",e)}},computed:{totalPrice(){const e=this.subtotal-this.discount;return e+this.vat},subtotal(){return this.orderItems.reduce(((e,t)=>e+(parseFloat(t.price_tax_excl)||0)*t.quantity),0)},vat(){const e=this.orderItems.reduce(((e,t)=>e+(parseFloat(t.price_tax_incl)-parseFloat(t.price_tax_excl))*t.quantity),0);return e},discount(){if(this.flatDiscountAmount>0)return this.flatDiscountAmount;if(this.discountPercentage>0){const e=this.subtotal+this.vat;return this.discountPercentage/100*e}return 0},calculateChange(){return(this.cashReceived-this.totalPrice).toFixed(2)}},methods:{removeItem(e){this.$emit("remove-item",e)},selectProduct(e){this.selectedProduct=e,this.editableQuantity=e.quantity},setQuantityMode(){this.quantityEditable=!0},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.orderList;e&&(e.scrollTop=e.scrollHeight)}))},handleKeyPress(e){this.selectedProduct&&this.quantityEditable?this.handleInput("editableQuantity",e):this.discountEditable?this.handleInput("discountPercentage",e):this.flatDiscountEditable&&this.handleInput("flatDiscountAmount",e)},handleInput(e,t){const n=this[e]?.toString()||"0";isNaN(t)?"delete"===t?this[e]=n.slice(0,-1)||"0":"."===t?n.includes(".")||(this[e]=n+"."):"enter"===t&&(this[e]=parseFloat(this[e])||0):this[e]="0"===n?t.toString():n+t.toString()},confirmQuantity(){const e=parseInt(this.editableQuantity,10);if(isNaN(e)||""===this.editableQuantity)return this.editableQuantity=this.selectedProduct.quantity,void(this.quantityEditable=!1);0===e?this.$emit("remove-item",this.selectedProduct.refcode):this.$emit("set-quantity",{refcode:this.selectedProduct.refcode,setQuantity:e}),this.quantityEditable=!1},handleOutsideClick(e){this.quantityEditable&&!this.$el.contains(e.target)&&this.confirmQuantity()},editDiscount(){this.discountEditable=!0,this.flatDiscountEditable=!1},editFlatDiscount(){this.flatDiscountEditable=!0,this.discountEditable=!1},startEditingDiscount(){this.previousDiscountPercentage=this.discountPercentage,this.discountEditable=!0},confirmDiscount(e){if("percentage"===e){if(this.discountPercentage<0||this.discountPercentage>100)return void(this.showPopup=!0);this.flatDiscountAmount=0,this.discountEditable=!1}else if("amount"===e){if(this.flatDiscountAmount<0||this.flatDiscountAmount>this.subtotal+this.vat)return void(this.showPopup=!0);this.discountPercentage=0,this.flatDiscountEditable=!1}this.discountPercentage=parseFloat(this.discountPercentage)||0,this.flatDiscountAmount=parseFloat(this.flatDiscountAmount)||0;const t={discount_type:e,value:"percentage"===e?this.discountPercentage:this.flatDiscountAmount};fetch(`${this.apiBaseUrl}/orders/apply-discount`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(t)}).then((e=>{if(!e.ok)throw new Error(`Server error: ${e.status}`);return e.json()})).then((e=>{e&&e.new_total&&(this.newTotal=e.new_total)})).catch((e=>{console.error("Error applying discount:",e)}))},closePopup(){this.showPopup=!1,this.discountPercentage=this.previousDiscountPercentage||0,this.flatDiscountAmount=this.previousFlatDiscountAmount||0},openModal(){this.showModal=!0},closeModal(){this.showModal=!1,this.showPaymentWarning=!1,this.selectedPaymentMethod=null},async confirmCheckout(){this.selectedPaymentMethod?(this.showPaymentConfirmation=!0,this.showPaymentWarning=!1):this.showPaymentWarning=!0},async createNewOrder(){try{const e=await y.A.post(`${this.apiBaseUrl}/orders/new`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handleNewOrderResponse(e.data)}catch(e){console.error("Error creating new order:",e)}},async cancelOrder(){try{const e=await y.A.post(`${this.apiBaseUrl}/orders/cancel`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handleCancelOrderResponse(e.data)}catch(e){console.error("Error canceling order:",e)}},async cancelPayment(){try{const e=await y.A.post(`${this.apiBaseUrl}/payment/cancel`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handleCancelOrderResponse(e.data)}catch(e){console.error("Error canceling payment:",e)}},async handlePaymentConfirmation(e){if(e){console.log("Payment completed successfully.");const e=this.totalPrice.toFixed(2),n="cash"===this.selectedPaymentMethod?"CASH":"CREDIT_CARD_OFFLINE";try{const t=await y.A.post(`${this.apiBaseUrl}/checkout`,{amount:e,paymentMethod:n},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});let s;this.handleCheckoutResponse(t.data),"cash"===this.selectedPaymentMethod?(s=await y.A.post(`${this.apiBaseUrl}/payment/cash`,{amount:e,paymentMethod:n},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}}),this.handleCashPaymentResponse(s.data)):"card"===this.selectedPaymentMethod&&(s=await y.A.post(`${this.apiBaseUrl}/payment/card`,{amount:e,paymentMethod:n},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}}),this.handleCardPaymentResponse(s.data))}catch(t){t.response&&400===t.response.status?console.log("Checkout failed:",t.response.data):console.error("An unexpected error occurred:",t)}this.showPaymentConfirmation=!1,this.selectedPaymentMethod=null,this.showReceiptPopup=!0}else this.showPaymentConfirmation=!1},async handleReceiptSelection(e){this.showReceiptPopup=!1,e?(this.showModal=!1,this.printReceipt(),console.log("User wants a receipt.")):(this.showModal=!1,console.log("User does not want a receipt.")),await this.createNewOrder(),this.discountPercentage=0,this.flatDiscountAmount=0,setTimeout((()=>{this.$emit("clear-order-items"),this.$emit("clear-selected-client")}),3e3)},async printReceipt(){try{const e=await y.A.get(`${this.apiBaseUrl}/orders?sort=date_desc&page=1&per_page=1`,{headers:{Authorization:`Bearer ${this.token}`}}),t=e.data.data.list;if(0===t.length)return void alert("No orders found.");const n=t[0];console.log("Order ID for printing:",n.id);const s=await y.A.post(`${this.apiBaseUrl}/orders/print-document`,{order_id:n.id,print_type:"RECEIPT"},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});this.handlePrintReceiptResponse(s.data)}catch(e){console.error("Error printing receipt:",e)}},handleCheckoutResponse(e){"success"===e.status?this.showPaymentConfirmation=!0:"fail"===e.status&&console.error("Checkout failed:",e.data.message)}},mounted(){document.addEventListener("click",this.handleOutsideClick)},beforeUnmount(){document.removeEventListener("click",this.handleOutsideClick)}};const ft=(0,v.A)(yt,[["render",gt]]);var vt=ft,Lt={components:{OrderSummary:vt},props:{selectedClient:Object,orderItems:{type:Array,required:!0},apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},token:{type:String,required:!0}},methods:{removeProductFromOrder(e){this.$emit("remove-item",e)},updateItemQuantity(e){this.$emit("update-quantity",e)},setItemQuantity(e){this.$emit("set-quantity",e)},forwardClearOrderItems(){this.$emit("clear-order-items")},forwardClearSelectedClient(){this.$emit("clear-selected-client")},forwardModalStateChange(e){this.$emit("modal-state-change",e)}}};const bt=(0,v.A)(Lt,[["render",ge]]);var Ct=bt;const Pt={class:"header-content"},wt={class:"search-bar"},It={class:"user-info"},Et={class:"user-signoff"},_t={key:0,class:"popup-overlay"},Tt={class:"popup-message"};function Ot(e,t,n,o,i,l){return(0,a.uX)(),(0,a.CE)("header",null,[(0,a.Lk)("div",Pt,[t[8]||(t[8]=(0,a.Lk)("span",{class:"header-title"},"Point of Sale",-1)),(0,a.Lk)("div",wt,[t[4]||(t[4]=(0,a.Lk)("i",{class:"fas fa-magnifying-glass search-icon"},null,-1)),(0,a.bo)((0,a.Lk)("input",{ref:"searchInput",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.barcodeInput=e),onInput:t[1]||(t[1]=(...e)=>i.debouncedOnBarcodeInput&&i.debouncedOnBarcodeInput(...e)),id:"barcodeInput",placeholder:"Zoek Product op Naam, Barcode, Product id"},null,544),[[s.Jo,i.barcodeInput]]),t[5]||(t[5]=(0,a.Lk)("i",{class:"fas fa-barcode barcode-icon"},null,-1))]),(0,a.Lk)("div",It,[t[6]||(t[6]=(0,a.Lk)("i",{class:"fas fa-user user-image"},null,-1)),(0,a.Lk)("span",null,(0,r.v_)(n.user?`${n.user.firstName} ${n.user.lastName}`:"John Doe"),1)]),(0,a.Lk)("div",Et,[t[7]||(t[7]=(0,a.Lk)("i",{class:"fas fa-right-from-bracket user-signofficon"},null,-1)),(0,a.Lk)("span",{onClick:t[2]||(t[2]=(...e)=>l.handleLogout&&l.handleLogout(...e))},"Afmelden")])]),i.showPopup?((0,a.uX)(),(0,a.CE)("div",_t,[(0,a.Lk)("div",Tt,[(0,a.Lk)("p",null,(0,r.v_)(this.translations.barcodeNotFound),1),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.closePopup&&l.closePopup(...e))},"Sluiten")])])):(0,a.Q3)("",!0)])}var xt={name:"HeaderComponent",props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0},disableFocus:{type:Boolean,default:!1},token:{type:String,required:!0},user:{type:Object,default:()=>null}},data(){return{barcodeInput:"",showPopup:!1,debouncedOnBarcodeInput:null,focusInterval:null}},watch:{disableFocus(e){e?clearInterval(this.focusInterval):this.focusInterval=setInterval(this.maintainFocus,100)}},methods:{debounce(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout((()=>e.apply(this,s)),t)}},async fetchProduct(e,t="BARCODE"){try{const n=await y.A.post(`${this.apiBaseUrl}/products/find`,{type:t,term:e},{headers:{Authorization:`Bearer ${this.token}`}}),s=n.data;return"success"===s.status&&s.data.length>0?s.data:null}catch(n){return console.error("Error fetching product:",n),this.showPopup=!0,null}},async onBarcodeInput(){const e=this.barcodeInput.trim();if(!e)return;let t;this.showPopup=!1,t=/^\d+$/.test(e)?12===e.length||13===e.length?"BARCODE":"ALL":e.match(/^[a-zA-Z0-9-]+$/)?"REFERENCE":"NAME";const n=await this.fetchProduct(e,t);if(n&&n.length>0){const e=n[0];this.$emit("product-scanned",e),this.barcodeInput=""}else this.showPopup=!0},closePopup(){this.showPopup=!1,this.barcodeInput=""},maintainFocus(){this.disableFocus||this.$refs.searchInput.focus()},handleLogout(){this.$emit("logout")}},mounted(){this.focusInterval=setInterval(this.maintainFocus,100),this.debouncedOnBarcodeInput=this.debounce(this.onBarcodeInput,50)},beforeUnmount(){clearInterval(this.focusInterval)}};const St=(0,v.A)(xt,[["render",Ot]]);var $t=St;const At={class:"sidebar"},Bt={class:"main-links"};function qt(e,t,n,s,o,r){const i=(0,a.g2)("router-link");return(0,a.uX)(),(0,a.CE)("aside",At,[(0,a.Lk)("nav",null,[(0,a.Lk)("ul",Bt,[(0,a.Lk)("li",null,[(0,a.bF)(i,{to:"/index.html"},{default:(0,a.k6)((()=>t[0]||(t[0]=[(0,a.Lk)("i",{class:"fas fa-home"},null,-1),(0,a.Lk)("span",null,"Home",-1)]))),_:1})]),(0,a.Lk)("li",null,[(0,a.bF)(i,{to:"/klanten"},{default:(0,a.k6)((()=>t[1]||(t[1]=[(0,a.Lk)("i",{class:"fas fa-users"},null,-1),(0,a.Lk)("span",null,"Klanten",-1)]))),_:1})]),(0,a.Lk)("li",null,[(0,a.bF)(i,{to:"/bestellingen"},{default:(0,a.k6)((()=>t[2]||(t[2]=[(0,a.Lk)("i",{class:"fas fa-shopping-cart"},null,-1),(0,a.Lk)("span",null,"Bestellingen",-1)]))),_:1})]),t[3]||(t[3]=(0,a.Lk)("li",null,[(0,a.Lk)("a",{href:"#"},[(0,a.Lk)("i",{class:"fas fa-chart-bar"}),(0,a.Lk)("span",null,"Rapportage")])],-1))]),t[4]||(t[4]=(0,a.Lk)("div",{class:"help-section"},[(0,a.Lk)("ul",null,[(0,a.Lk)("li",null,[(0,a.Lk)("a",{href:"#"},[(0,a.Lk)("i",{class:"fas fa-question-circle"}),(0,a.Lk)("span",null,"Help")])])])],-1))])])}var Ft={name:"SidebarComponent"};const Dt=(0,v.A)(Ft,[["render",qt]]);var Ut=Dt;const Mt={key:0,class:"popup-overlay"},Qt={class:"popup-message"};function Xt(e,t,n,s,o,i){return o.visible?((0,a.uX)(),(0,a.CE)("div",Mt,[(0,a.Lk)("div",Qt,[(0,a.Lk)("p",null,(0,r.v_)(o.message),1),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>i.closePopup&&i.closePopup(...e))},"Sluiten")])])):(0,a.Q3)("",!0)}var Rt={data(){return{visible:!1,message:""}},methods:{showPopup(e){this.message=e,this.visible=!0},closePopup(){this.visible=!1}}};const jt=(0,v.A)(Rt,[["render",Xt]]);var Kt=jt,Nt={components:{LoginComponent:me,CashRegister:Ct,HeaderComponent:$t,SidebarComponent:Ut,ErrorPopup:Kt},watch:{token(e){e?this.setupInactivityListener():this.cleanupInactivityListener()}},props:{apiBaseUrl:{type:String,required:!0},translations:{type:Object,required:!0}},data(){return{orderItems:[],token:null,user:null,disableFocus:!1,inactivityTimeout:null,tokenExpirationTime:null,tokenExchangeTimeout:null,selectedClient:null}},methods:{async fetchCurrentOrder(){try{const e=await y.A.get(`${this.apiBaseUrl}/orders/current`,{headers:{Authorization:`Bearer ${this.token}`}}),t=e.data?.data?.cart;t&&Array.isArray(t.lines)?this.orderItems=t.lines.map((e=>({product_id:e.product_id,refcode:e.reference,name:e.name,price_tax_incl:e.price_tax_incl,price_tax_excl:e.price_tax_excl,quantity:e.quantity,image_url:e.image_url}))):(console.warn("No cart or lines data available in the response."),this.orderItems=[])}catch(e){console.error("Error fetching current order:",e)}},async addProductToOrder(e){let t=this.orderItems.find((t=>t.refcode===e.refcode));if(t&&t.quantity+1>e.stock)alert(`Cannot add more than available stock of ${e.stock}`);else if(!t&&e.stock<1)alert(this.translations.outOfStock);else try{const n=await y.A.post(`${this.apiBaseUrl}/orders/add-product-to-order`,{refcode:e.refcode,quantity:1},{headers:{Authorization:`Bearer ${this.token}`}});if("fail"===n.data.status&&"OUT_OF_STOCK"===n.data.data.code){const e=n.data.data.quantityAvailable;return alert(`Only ${e} items are available in stock. Please adjust your quantity.`),void(t&&(t.quantity=e))}t?t.quantity+=1:this.orderItems.push({...e,quantity:1}),console.log("Updated order summary:",n.data)}catch(n){n.response&&422===n.response.status?this.$refs.errorPopup.showPopup(this.translations.outOfStock):console.error("Error adding product to order:",n)}},async removeProductFromOrder(e){const t=[...this.orderItems];this.orderItems=this.orderItems.filter((t=>t.refcode!==e));try{const n=await y.A.post(`${this.apiBaseUrl}/orders/delete-product-from-order`,{refcode:e},{headers:{Authorization:`Bearer ${this.token}`}});"success"===n.data.status?console.log("Item successfully deleted from the order."):"fail"===n.data.status&&(this.handleError(n.data.data),this.orderItems=t)}catch(n){console.error("Error removing product from order:",n),this.orderItems=t}},async updateItemQuantity({refcode:e,quantity:t}){const n=this.orderItems.findIndex((t=>t.refcode===e));if(-1!==n){const o=this.orderItems[n],a=o.quantity+t;if(a<=0)return void this.removeProductFromOrder(e);if(a>o.stock)return void alert(`Cannot update quantity. Available stock is ${o.stock}.`);try{const t=await y.A.post(`${this.apiBaseUrl}/orders/change-quantity`,{refcode:e,quantity:a},{headers:{Authorization:`Bearer ${this.token}`}});if("fail"===t.data.status&&"OUT_OF_STOCK"===t.data.data.code){const e=t.data.data.quantityAvailable;return alert(`Only ${e} items are available in stock. Please adjust your quantity.`),void(o.quantity=e)}o.quantity=a,console.log("Updated order summary:",t.data)}catch(s){s.response&&422===s.response.status?this.$refs.errorPopup.showPopup(this.translations.outOfStock):console.error("Error updating product quantity:",s)}}else console.error(`Item with refcode ${e} not found in the order.`)},async setItemQuantity({refcode:e,setQuantity:t}){const n=this.orderItems.findIndex((t=>t.refcode===e));if(-1!==n){const o=this.orderItems[n];if(t>o.stock)return void this.$refs.errorPopup.showPopup(`Requested quantity of ${t} exceeds available stock of ${o.stock}.`);try{const n=await y.A.post(`${this.apiBaseUrl}/orders/change-quantity`,{refcode:e,quantity:t},{headers:{Authorization:`Bearer ${this.token}`}});if("fail"===n.data.status&&"OUT_OF_STOCK"===n.data.data.code){const e=n.data.data.quantityAvailable;return this.$refs.errorPopup.showPopup(`Only ${e} items are available. Adjusting quantity to available stock.`),void(o.quantity=e)}o.quantity=t,console.log("Quantity successfully updated:",n.data)}catch(s){s.response&&422===s.response.status?this.$refs.errorPopup.showPopup(this.translations.outOfStock):console.error("Error updating quantity:",s)}}else console.error(`Item with refcode ${e} not found in the order.`)},clearOrderItems(){this.orderItems=[]},updateModalState(e){this.disableFocus=e},updateFocusState(e){this.disableFocus=e},handleClientSelection(e){this.selectedClient=e},logout(){this.clearTokenData()},resetInactivityTimer(){this.inactivityTimeout&&clearTimeout(this.inactivityTimeout),this.inactivityTimeout=setTimeout((()=>{this.logout()}),9e5)},setupInactivityListener(){const e=["mousemove","keydown","click","scroll"];e.forEach((e=>{window.addEventListener(e,this.resetInactivityTimer)})),this.resetInactivityTimer()},cleanupInactivityListener(){this.inactivityTimeout&&clearTimeout(this.inactivityTimeout);const e=["mousemove","keydown","click","scroll"];e.forEach((e=>{window.removeEventListener(e,this.resetInactivityTimer)}))},async setToken(e,t=!1){try{const n=await y.A.get(`${this.apiBaseUrl}/token`,{headers:{Authorization:`Bearer ${e}`}});if("success"===n.data.status){const{firstname:s,lastname:o,token:a}=n.data.data,{expiresIn:r}=a;return this.token=e,this.user={firstName:s,lastName:o},console.log("ExpiresIn received:",r),console.log("Full API response:",n.data),this.tokenExpirationTime=Date.now()+1e3*r,localStorage.setItem("authToken",e),localStorage.setItem("userFirstName",s),localStorage.setItem("userLastName",o),localStorage.setItem("tokenExpirationTime",this.tokenExpirationTime),t||this.scheduleTokenExchange(r),!0}}catch(n){console.error("Error validating token:",n)}return this.clearTokenData(),!1},scheduleTokenExchange(e){if(!e||isNaN(e))return void console.error("Invalid expiresIn value. Cannot schedule token exchange.");const t=1e3*(e-300);if(t<=0)return console.warn("Token has less than 60 seconds. Exchanging immediately."),void this.exchangeToken();this.tokenExchangeTimeout&&clearTimeout(this.tokenExchangeTimeout),this.tokenExchangeTimeout=setTimeout((()=>{this.exchangeToken()}),t),console.log(`Token exchange scheduled in ${(t/1e3).toFixed(1)} seconds.`)},async exchangeToken(){try{const e=await y.A.post(`${this.apiBaseUrl}/token/exchange`,{},{headers:{Authorization:`Bearer ${this.token}`}});if(200===e.status){const t=e.data.data.token.value;console.log("Token exchanged successfully."),await this.setToken(t,!0)}else console.warn("Token exchange failed. Logging out."),this.logout()}catch(e){console.error("Error exchanging token:",e),this.logout()}},clearTokenData(){this.token=null,this.user=null,this.tokenExpirationTime=null,localStorage.removeItem("authToken"),localStorage.removeItem("userFirstName"),localStorage.removeItem("userLastName"),localStorage.removeItem("tokenExpirationTime"),this.tokenExchangeTimeout&&clearTimeout(this.tokenExchangeTimeout)},handleError(e){switch(e.code){case"NOT_FOUND":console.error("Product not found:",e.message);break;case"BAD_REQUEST":console.error("Bad request:",e.message);break;case"OUT_OF_STOCK":console.error("Out of stock:",e.message),alert("This product is currently out of stock.");break;case"MINIMAL_QUANTITY_REQUIRED":console.error("Minimum quantity required:",e.message);break;default:console.error("An unknown error occurred.")}}},mounted(){const e=localStorage.getItem("authToken"),t=parseInt(localStorage.getItem("tokenExpirationTime"),10);if(e&&t>Date.now()){const n=(t-Date.now())/1e3;this.setToken(e).then((e=>{e?(this.scheduleTokenExchange(n),this.fetchCurrentOrder()):(console.warn("Stored token is invalid. Logging out."),this.logout())}))}else console.warn("No valid token found. Redirecting to login."),this.logout();this.token&&(this.fetchCurrentOrder(),this.setupInactivityListener())},beforeUnmount(){this.tokenExchangeTimeout&&clearTimeout(this.tokenExchangeTimeout),this.cleanupInactivityListener()}};const Wt=(0,v.A)(Nt,[["render",ae]]);var zt=Wt;window.startPOS=(e,t)=>{const n=(0,s.Ef)(zt,t);n.use(Z),n.mount(e)}}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,s,o,a){if(!s){var r=1/0;for(u=0;u<e.length;u++){s=e[u][0],o=e[u][1],a=e[u][2];for(var i=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(i=!1,a<r&&(r=a));if(i){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[s,o,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,a,r=s[0],i=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(l)var u=l(n)}for(t&&t(s);c<r.length;c++)a=r[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},s=self["webpackChunkpossystem"]=self["webpackChunkpossystem"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],(function(){return n(1987)}));s=n.O(s)})();
//# sourceMappingURL=app.js.map